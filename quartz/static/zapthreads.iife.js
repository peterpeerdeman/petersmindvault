var ZapThreads=function(){"use strict";var e=Object.defineProperty,t=(t,n,r)=>(((t,n,r)=>{n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r})(t,"symbol"!=typeof n?n+"":n,r),r);const n=Symbol("solid-proxy"),r=Symbol("solid-track"),o={equals:(e,t)=>e===t};let i=L;const s=1,a=2,c={owned:null,cleanups:null,context:null,owner:null},l={};var u=null;let f,d=null,h=null,p=null,g=null,y=0;function w(e,t){const n=h,r=u,o=0===e.length,i=void 0===t?r:t,s=o?c:{owned:null,cleanups:null,context:i?i.context:null,owner:i},a=o?e:()=>e((()=>S((()=>j(s)))));u=s,h=null;try{return P(a,!0)}finally{h=n,u=r}}function m(e,t){const n={value:e,observers:null,observerSlots:null,comparator:(t=t?Object.assign({},o,t):o).equals||void 0};return[O.bind(n),e=>("function"==typeof e&&(e=e(n.value)),_(n,e))]}function b(e,t,n){T(I(e,t,!0,s))}function v(e,t,n){T(I(e,t,!1,s))}function E(e,t,n){i=R;const r=I(e,t,!1,s),o=f&&(a=f,u&&u.context&&void 0!==u.context[a.id]?u.context[a.id]:a.defaultValue);var a;o&&(r.suspense=o),n&&n.render||(r.user=!0),g?g.push(r):T(r)}function x(e,t,n){n=n?Object.assign({},o,n):o;const r=I(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,T(r),O.bind(r)}function A(e,t,n){let r,o,i;2===arguments.length&&"object"==typeof t||1===arguments.length?(r=!0,o=e,i=t||{}):(r=e,o=t,i=n||{});let s=null,a=l,c=!1,u="initialValue"in i,d="function"==typeof r&&x(r);const p=new Set,[g,y]=(i.storage||m)(i.initialValue),[w,v]=m(void 0),[E,A]=m(void 0,{equals:!1}),[k,B]=m(u?"ready":"unresolved");function $(e,t,n,r){return s===e&&(s=null,void 0!==r&&(u=!0),e!==a&&t!==a||!i.onHydrated||queueMicrotask((()=>i.onHydrated(r,{value:t}))),a=l,function(e,t){P((()=>{void 0===t&&y((()=>e)),B(void 0!==t?"errored":u?"ready":"unresolved"),v(t);for(const e of p.keys())e.decrement();p.clear()}),!1)}(t,n)),t}function z(){const e=f,t=g(),n=w();if(void 0!==n&&!s)throw n;return h&&!h.user&&e&&b((()=>{E(),s&&(e.resolved||p.has(e)||(e.increment(),p.add(e)))})),t}function O(e=!0){if(!1!==e&&c)return;c=!1;const t=d?d():r;if(null==t||!1===t)return void $(s,S(g));const n=a!==l?a:S((()=>o(t,{value:g(),refetching:e})));return(i=n)&&"object"==typeof i&&"then"in i?(s=n,"value"in n?("success"===n.status?$(s,n.value,void 0,t):$(s,void 0,void 0,t),n):(c=!0,queueMicrotask((()=>c=!1)),P((()=>{B(u?"refreshing":"pending"),A()}),!1),n.then((e=>$(n,e,void 0,t)),(e=>$(n,void 0,H(e),t))))):($(s,n,void 0,t),n);var i}return Object.defineProperties(z,{state:{get:()=>k()},error:{get:()=>w()},loading:{get(){const e=k();return"pending"===e||"refreshing"===e}},latest:{get(){if(!u)return z();const e=w();if(e&&!s)throw e;return g()}}}),d?b((()=>O(!1))):O(!1),[z,{refetch:O,mutate:y}]}function k(e){return P(e,!1)}function S(e){if(null===h)return e();const t=h;h=null;try{return e()}finally{h=t}}function B(e,t,n){const r=Array.isArray(e);let o,i=n&&n.defer;return n=>{let s;if(r){s=Array(e.length);for(let t=0;t<e.length;t++)s[t]=e[t]()}else s=e();if(i)return void(i=!1);const a=S((()=>t(s,o,n)));return o=s,a}}function $(e){return null===u||(null===u.cleanups?u.cleanups=[e]:u.cleanups.push(e)),e}function z(){return h}function O(){if(this.sources&&this.state)if(this.state===s)T(this);else{const e=p;p=null,P((()=>N(this)),!1),p=e}if(h){const e=this.observers?this.observers.length:0;h.sources?(h.sources.push(this),h.sourceSlots.push(e)):(h.sources=[this],h.sourceSlots=[e]),this.observers?(this.observers.push(h),this.observerSlots.push(h.sources.length-1)):(this.observers=[h],this.observerSlots=[h.sources.length-1])}return this.value}function _(e,t,n){let r=e.value;return e.comparator&&e.comparator(r,t)||(e.value=t,e.observers&&e.observers.length&&P((()=>{for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t],r=d&&d.running;r&&d.disposed.has(n),(r?n.tState:n.state)||(n.pure?p.push(n):g.push(n),n.observers&&U(n)),r||(n.state=s)}if(p.length>1e6)throw p=[],new Error}),!1)),t}function T(e){if(!e.fn)return;j(e);const t=u,n=h,r=y;h=u=e,function(e,t,n){let r;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=s,e.owned&&e.owned.forEach(j),e.owned=null),e.updatedAt=n+1,D(o)}(!e.updatedAt||e.updatedAt<=n)&&(null!=e.updatedAt&&"observers"in e?_(e,r):e.value=r,e.updatedAt=n)}(e,e.value,r),h=n,u=t}function I(e,t,n,r=s,o){const i={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:u,context:u?u.context:null,pure:n};return null===u||u!==c&&(u.owned?u.owned.push(i):u.owned=[i]),i}function C(e){if(0===e.state)return;if(e.state===a)return N(e);if(e.suspense&&S(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<y);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if((e=t[n]).state===s)T(e);else if(e.state===a){const n=p;p=null,P((()=>N(e,t[0])),!1),p=n}}function P(e,t){if(p)return e();let n=!1;t||(p=[]),g?n=!0:g=[],y++;try{const t=e();return function(e){p&&(L(p),p=null);if(e)return;const t=g;g=null,t.length&&P((()=>i(t)),!1)}(n),t}catch(r){n||(g=null),p=null,D(r)}}function L(e){for(let t=0;t<e.length;t++)C(e[t])}function R(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:C(r)}for(t=0;t<n;t++)C(e[t])}function N(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const e=r.state;e===s?r!==t&&(!r.updatedAt||r.updatedAt<y)&&C(r):e===a&&N(r,t)}}}function U(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=a,n.pure?p.push(n):g.push(n),n.observers&&U(n))}}function j(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),n=e.sourceSlots.pop(),r=t.observers;if(r&&r.length){const e=r.pop(),o=t.observerSlots.pop();n<r.length&&(e.sourceSlots[o]=n,r[n]=e,t.observerSlots[n]=o)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)j(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function H(e){return e instanceof Error?e:new Error("string"==typeof e?e:"Unknown error",{cause:e})}function D(e,t=u){throw H(e)}const q=Symbol("fallback");function M(e){for(let t=0;t<e.length;t++)e[t]()}function V(e,t){return S((()=>e(t||{})))}function F(e){const t="fallback"in e&&{fallback:()=>e.fallback};return x(function(e,t,n={}){let o,i=[],s=[],a=[],c=[],l=0;return $((()=>M(a))),()=>{const u=e()||[];return u[r],S((()=>{if(0===u.length)return 0!==l&&(M(a),a=[],i=[],s=[],l=0,c=[]),n.fallback&&(i=[q],s[0]=w((e=>(a[0]=e,n.fallback()))),l=1),s;for(i[0]===q&&(a[0](),a=[],i=[],s=[],l=0),o=0;o<u.length;o++)o<i.length&&i[o]!==u[o]?c[o]((()=>u[o])):o>=i.length&&(s[o]=w(f));for(;o<i.length;o++)a[o]();return l=c.length=a.length=u.length,i=u.slice(0),s=s.slice(0,l)}));function f(e){a[o]=e;const[n,r]=m(u[o]);return c[o]=r,t(n,o)}}}((()=>e.each),e.children,t||void 0))}function W(e){const t=e.keyed,n=x((()=>e.when),void 0,{equals:(e,n)=>t?e===n:!e==!n});return x((()=>{const r=n();if(r){const o=e.children;return"function"==typeof o&&o.length>0?S((()=>o(t?r:()=>{if(!S(n))throw`Stale read from <${"Show"}>.`;return e.when}))):o}return e.fallback}),void 0,void 0)}const K="_$DX_DELEGATE";function Z(e,t,n){let r;const o=()=>{const t=document.createElement("template");return t.innerHTML=e,n?t.content.firstChild.firstChild:t.content.firstChild},i=t?()=>S((()=>document.importNode(r||(r=o()),!0))):()=>(r||(r=o())).cloneNode(!0);return i.cloneNode=i,i}function G(e,t=window.document){const n=t[K]||(t[K]=new Set);for(let r=0,o=e.length;r<o;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,X))}}function J(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function Y(e,t,n){return S((()=>e(t,n)))}function Q(e,t,n,r){if(void 0===n||r||(r=[]),"function"!=typeof t)return ee(e,t,r,n);v((r=>ee(e,t(),r,n)),r)}function X(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>n||document});n;){const r=n[t];if(r&&!n.disabled){const o=n[`${t}Data`];if(void 0!==o?r.call(n,o,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function ee(e,t,n,r,o){for(;"function"==typeof n;)n=n();if(t===n)return n;const i=typeof t,s=void 0!==r;if(e=s&&n[0]&&n[0].parentNode||e,"string"===i||"number"===i)if("number"===i&&(t=t.toString()),s){let o=n[0];o&&3===o.nodeType?o.data=t:o=document.createTextNode(t),n=re(e,n,r,o)}else n=""!==n&&"string"==typeof n?e.firstChild.data=t:e.textContent=t;else if(null==t||"boolean"===i)n=re(e,n,r);else{if("function"===i)return v((()=>{let o=t();for(;"function"==typeof o;)o=o();n=ee(e,o,n,r)})),()=>n;if(Array.isArray(t)){const i=[],a=n&&Array.isArray(n);if(te(i,t,n,o))return v((()=>n=ee(e,i,n,r,!0))),()=>n;if(0===i.length){if(n=re(e,n,r),s)return n}else a?0===n.length?ne(e,i,r):function(e,t,n){let r=n.length,o=t.length,i=r,s=0,a=0,c=t[o-1].nextSibling,l=null;for(;s<o||a<i;)if(t[s]!==n[a]){for(;t[o-1]===n[i-1];)o--,i--;if(o===s){const t=i<r?a?n[a-1].nextSibling:n[i-a]:c;for(;a<i;)e.insertBefore(n[a++],t)}else if(i===a)for(;s<o;)l&&l.has(t[s])||t[s].remove(),s++;else if(t[s]===n[i-1]&&n[a]===t[o-1]){const r=t[--o].nextSibling;e.insertBefore(n[a++],t[s++].nextSibling),e.insertBefore(n[--i],r),t[o]=n[i]}else{if(!l){l=new Map;let e=a;for(;e<i;)l.set(n[e],e++)}const r=l.get(t[s]);if(null!=r)if(a<r&&r<i){let c,u=s,f=1;for(;++u<o&&u<i&&null!=(c=l.get(t[u]))&&c===r+f;)f++;if(f>r-a){const o=t[s];for(;a<r;)e.insertBefore(n[a++],o)}else e.replaceChild(n[a++],t[s++])}else s++;else t[s++].remove()}}else s++,a++}(e,n,i):(n&&re(e),ne(e,i));n=i}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=re(e,n,r,t);re(e,n,null,t)}else null!=n&&""!==n&&e.firstChild?e.replaceChild(t,e.firstChild):e.appendChild(t);n=t}}return n}function te(e,t,n,r){let o=!1;for(let i=0,s=t.length;i<s;i++){let s,a=t[i],c=n&&n[i];if(null==a||!0===a||!1===a);else if("object"==(s=typeof a)&&a.nodeType)e.push(a);else if(Array.isArray(a))o=te(e,a,c)||o;else if("function"===s)if(r){for(;"function"==typeof a;)a=a();o=te(e,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||o}else e.push(a),o=!0;else{const t=String(a);c&&3===c.nodeType&&c.data===t?e.push(c):e.push(document.createTextNode(t))}}return o}function ne(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function re(e,t,n,r){if(void 0===n)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let r=!1;for(let i=t.length-1;i>=0;i--){const s=t[i];if(o!==s){const t=s.parentNode===e;r||i?t&&s.remove():t?e.replaceChild(o,s):e.insertBefore(o,n)}else r=!0}}else e.insertBefore(o,n);return[o]}function oe(e){return Object.keys(e).reduce(((t,n)=>{const r=e[n];var o;return t[n]=Object.assign({},r),ae(r.value)&&(o=r.value,"[object Function]"!==Object.prototype.toString.call(o))&&!Array.isArray(r.value)&&(t[n].value=Object.assign({},r.value)),Array.isArray(r.value)&&(t[n].value=r.value.slice(0)),t}),{})}function ie(e){if(e)try{return JSON.parse(e)}catch(t){return e}}function se(e,t,n){if(null==n||!1===n)return e.removeAttribute(t);let r=JSON.stringify(n);e.__updating[t]=!0,"true"===r&&(r=""),e.setAttribute(t,r),Promise.resolve().then((()=>delete e.__updating[t]))}function ae(e){return null!=e&&("object"==typeof e||"function"==typeof e)}let ce;function le(e,t){const n=Object.keys(t);return class extends e{static get observedAttributes(){return n.map((e=>t[e].attribute))}constructor(){super(),this.__initialized=!1,this.__released=!1,this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props={}}connectedCallback(){if(this.__initialized)return;this.__releaseCallbacks=[],this.__propertyChangedCallbacks=[],this.__updating={},this.props=function(e,t){const n=oe(t);return Object.keys(t).forEach((t=>{const r=n[t],o=e.getAttribute(r.attribute),i=e[t];o&&(r.value=r.parse?ie(o):o),null!=i&&(r.value=Array.isArray(i)?i.slice(0):i),r.reflect&&se(e,r.attribute,r.value),Object.defineProperty(e,t,{get:()=>r.value,set(e){const n=r.value;r.value=e,r.reflect&&se(this,r.attribute,r.value);for(let r=0,o=this.__propertyChangedCallbacks.length;r<o;r++)this.__propertyChangedCallbacks[r](t,e,n)},enumerable:!0,configurable:!0})})),n}(this,t);const e=function(e){return Object.keys(e).reduce(((t,n)=>(t[n]=e[n].value,t)),{})}(this.props),n=this.Component,r=ce;try{ce=this,this.__initialized=!0,"function"==typeof(o=n)&&0===o.toString().indexOf("class")?new n(e,{element:this}):n(e,{element:this})}finally{ce=r}var o}async disconnectedCallback(){if(await Promise.resolve(),this.isConnected)return;this.__propertyChangedCallbacks.length=0;let e=null;for(;e=this.__releaseCallbacks.pop();)e(this);delete this.__initialized,this.__released=!0}attributeChangedCallback(e,n,r){if(this.__initialized&&!this.__updating[e]&&(e=this.lookupProp(e))in t){if(null==r&&!this[e])return;this[e]=t[e].parse?ie(r):r}}lookupProp(e){if(t)return n.find((n=>e===n||e===t[n].attribute))}get renderRoot(){return this.shadowRoot||this.attachShadow({mode:"open"})}addReleaseCallback(e){this.__releaseCallbacks.push(e)}addPropertyChangedCallback(e){this.__propertyChangedCallbacks.push(e)}}}function ue(e,t={},n={}){const{BaseElement:r=HTMLElement,extension:o}=n;return n=>{if(!e)throw new Error("tag is required to register a Component");let i=customElements.get(e);return i?(i.prototype.Component=n,i):(i=le(r,function(e){return e?Object.keys(e).reduce(((t,n)=>{const r=e[n];return t[n]=ae(r)&&"value"in r?r:{value:r},t[n].attribute||(t[n].attribute=n.replace(/\.?([A-Z]+)/g,((e,t)=>"-"+t.toLowerCase())).replace("_","-").replace(/^-/,"")),t[n].parse="parse"in t[n]?t[n].parse:"string"!=typeof t[n].value,t}),{}):{}}(t)),i.prototype.Component=n,i.prototype.registeredTag=e,customElements.define(e,i,o),i)}}function fe(e){return(t,n)=>{const{element:r}=n;return w((o=>{const i=function(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const[o,i]=m(e[t[r]]);Object.defineProperty(n,t[r],{get:o,set(e){i((()=>e))}})}return n}(t);r.addPropertyChangedCallback(((e,t)=>i[e]=t)),r.addReleaseCallback((()=>{r.renderRoot.textContent="",o()}));const s=e(i,n);return Q(r.renderRoot,s)}),function(e){if(e.assignedSlot&&e.assignedSlot._$owner)return e.assignedSlot._$owner;let t=e.parentNode;for(;t&&!t._$owner&&(!t.assignedSlot||!t.assignedSlot._$owner);)t=t.parentNode;return t&&t.assignedSlot?t.assignedSlot._$owner:e._$owner}(r))}}function de(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function he(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function pe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const ge="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,ye=e=>e instanceof Uint8Array,we=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),me=(e,t)=>e<<32-t|e>>>t;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function be(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!ye(e))throw new Error("expected Uint8Array, got "+typeof e);return e}let ve=class{clone(){return this._cloneInto()}};function Ee(e){const t=t=>e().update(be(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function xe(e=32){if(ge&&"function"==typeof ge.getRandomValues)return ge.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}let Ae=class extends ve{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=we(this.buffer)}update(e){pe(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=be(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=we(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){pe(this),function(e,t){he(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let u=i;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),c=r?4:0,l=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=we(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<c;u++)s.setUint32(4*u,l[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}};const ke=(e,t,n)=>e&t^e&n^t&n,Se=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Be=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),$e=new Uint32Array(64);let ze=class extends Ae{constructor(){super(64,32,8,!1),this.A=0|Be[0],this.B=0|Be[1],this.C=0|Be[2],this.D=0|Be[3],this.E=0|Be[4],this.F=0|Be[5],this.G=0|Be[6],this.H=0|Be[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let f=0;f<16;f++,t+=4)$e[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const e=$e[f-15],t=$e[f-2],n=me(e,7)^me(e,18)^e>>>3,r=me(t,17)^me(t,19)^t>>>10;$e[f]=r+$e[f-7]+n+$e[f-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:c,H:l}=this;for(let f=0;f<64;f++){const e=l+(me(s,6)^me(s,11)^me(s,25))+((u=s)&a^~u&c)+Se[f]+$e[f]|0,t=(me(n,2)^me(n,13)^me(n,22))+ke(n,r,o)|0;l=c,c=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,i,s,a,c,l)}roundClean(){$e.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Oe=Ee((()=>new ze)),_e=BigInt(0),Te=BigInt(1),Ie=BigInt(2),Ce=e=>e instanceof Uint8Array,Pe=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Le(e){if(!Ce(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Pe[e[n]];return t}function Re(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function Ne(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function Ue(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const t=2*r,o=e.slice(t,t+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function je(e){return Ne(Le(e))}function He(e){if(!Ce(e))throw new Error("Uint8Array expected");return Ne(Le(Uint8Array.from(e).reverse()))}function De(e,t){return Ue(e.toString(16).padStart(2*t,"0"))}function qe(e,t){return De(e,t).reverse()}function Me(e,t,n){let r;if("string"==typeof t)try{r=Ue(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else{if(!Ce(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const o=r.length;if("number"==typeof n&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function Ve(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Ce(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const Fe=e=>(Ie<<BigInt(e-1))-Te,We=e=>new Uint8Array(e),Ke=e=>Uint8Array.from(e);function Ze(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=We(e),o=We(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},a=(...e)=>n(o,r,...e),c=(e=We())=>{o=a(Ke([0]),e),r=a(),0!==e.length&&(o=a(Ke([1]),e),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return Ve(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(l()));)c();return s(),n}}const Ge={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function Je(e,t,n={}){const r=(t,n,r)=>{const o=Ge[n];if("function"!=typeof o)throw new Error(`Invalid validator "${n}", expected function`);const i=e[t];if(!(r&&void 0===i||o(i,e)))throw new Error(`Invalid param ${String(t)}=${i} (${typeof i}), expected ${n}`)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}const Ye=Object.freeze(Object.defineProperty({__proto__:null,bitGet:function(e,t){return e>>BigInt(t)&Te},bitLen:function(e){let t;for(t=0;e>_e;e>>=Te,t+=1);return t},bitMask:Fe,bitSet:(e,t,n)=>e|(n?Te:_e)<<BigInt(t),bytesToHex:Le,bytesToNumberBE:je,bytesToNumberLE:He,concatBytes:Ve,createHmacDrbg:Ze,ensureBytes:Me,equalBytes:function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},hexToBytes:Ue,hexToNumber:Ne,numberToBytesBE:De,numberToBytesLE:qe,numberToHexUnpadded:Re,numberToVarBytesBE:function(e){return Ue(Re(e))},utf8ToBytes:function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))},validateObject:Je},Symbol.toStringTag,{value:"Module"})),Qe=BigInt(0),Xe=BigInt(1),et=BigInt(2),tt=BigInt(3),nt=BigInt(4),rt=BigInt(5),ot=BigInt(8);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function it(e,t){const n=e%t;return n>=Qe?n:t+n}function st(e,t,n){if(n<=Qe||t<Qe)throw new Error("Expected power/modulo > 0");if(n===Xe)return Qe;let r=Xe;for(;t>Qe;)t&Xe&&(r=r*e%n),e=e*e%n,t>>=Xe;return r}function at(e,t,n){let r=e;for(;t-- >Qe;)r*=r,r%=n;return r}function ct(e,t){if(e===Qe||t<=Qe)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=it(e,t),r=t,o=Qe,i=Xe;for(;n!==Qe;){const e=r%n,t=o-i*(r/n);r=n,n=e,o=i,i=t}if(r!==Xe)throw new Error("invert: does not exist");return it(o,t)}function lt(e){if(e%nt===tt){const t=(e+Xe)/nt;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%ot===rt){const t=(e-rt)/ot;return function(e,n){const r=e.mul(n,et),o=e.pow(r,t),i=e.mul(n,o),s=e.mul(e.mul(i,et),o),a=e.mul(i,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Xe)/et;let n,r,o;for(n=e-Xe,r=0;n%et===Qe;n/=et,r++);for(o=et;o<e&&st(o,t,e)!==e-Xe;o++);if(1===r){const t=(e+Xe)/nt;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+Xe)/et;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,o),n),l=e.pow(s,i),u=e.pow(s,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const n=e.pow(c,Xe<<BigInt(a-t-1));c=e.sqr(n),l=e.mul(l,n),u=e.mul(u,c),a=t}return l}}(e)}BigInt(9),BigInt(16);const ut=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ft(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function dt(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function ht(e){const t=dt(e);return t+Math.ceil(t/2)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const pt=BigInt(0),gt=BigInt(1);function yt(e){return Je(e.Fp,ut.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Je(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...ft(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const{bytesToNumberBE:wt,hexToBytes:mt}=Ye,bt={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=bt;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:wt(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=bt,n="string"==typeof e?mt(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=bt._parseInt(n.subarray(2)),{d:s,l:a}=bt._parseInt(i);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),o=t(n(e.r)),i=r.length/2,s=o.length/2,a=n(i),c=n(s);return`30${n(s+i+4)}02${c}${o}02${a}${r}`}},vt=BigInt(0),Et=BigInt(1);BigInt(2);const xt=BigInt(3);function At(e){const t=function(e){const t=yt(e);Je(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const o=t.toAffine();return Ve(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),o=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function i(e){const{a:r,b:o}=t,i=n.sqr(e),s=n.mul(i,e);return n.add(n.add(s,n.mul(e,r)),o)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&vt<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:i}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=Le(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:je(Me("private key",e,r))}catch(c){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return o&&(s=it(s,i)),a(s),s}const l=new Map;function u(e){if(!(e instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof f)throw new Error("projective point not allowed");const o=e=>n.eql(e,n.ZERO);return o(t)&&o(r)?f.ZERO:new f(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(f.fromAffine)}static fromHex(e){const t=f.fromAffine(o(Me("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return f.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const o=n.sqr(r),s=i(e);if(!n.eql(o,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:o}=this,{px:i,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(i,o)),l=n.eql(n.mul(r,a),n.mul(s,o));return c&&l}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,o=n.mul(r,xt),{px:i,py:s,pz:a}=this;let c=n.ZERO,l=n.ZERO,u=n.ZERO,d=n.mul(i,i),h=n.mul(s,s),p=n.mul(a,a),g=n.mul(i,s);return g=n.add(g,g),u=n.mul(i,a),u=n.add(u,u),c=n.mul(e,u),l=n.mul(o,p),l=n.add(c,l),c=n.sub(h,l),l=n.add(h,l),l=n.mul(c,l),c=n.mul(g,c),u=n.mul(o,u),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,p),d=n.mul(d,g),l=n.add(l,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),u=n.mul(p,h),u=n.add(u,u),u=n.add(u,u),new f(c,l,u)}add(e){u(e);const{px:r,py:o,pz:i}=this,{px:s,py:a,pz:c}=e;let l=n.ZERO,d=n.ZERO,h=n.ZERO;const p=t.a,g=n.mul(t.b,xt);let y=n.mul(r,s),w=n.mul(o,a),m=n.mul(i,c),b=n.add(r,o),v=n.add(s,a);b=n.mul(b,v),v=n.add(y,w),b=n.sub(b,v),v=n.add(r,i);let E=n.add(s,c);return v=n.mul(v,E),E=n.add(y,m),v=n.sub(v,E),E=n.add(o,i),l=n.add(a,c),E=n.mul(E,l),l=n.add(w,m),E=n.sub(E,l),h=n.mul(p,v),l=n.mul(g,m),h=n.add(l,h),l=n.sub(w,h),h=n.add(w,h),d=n.mul(l,h),w=n.add(y,y),w=n.add(w,y),m=n.mul(p,m),v=n.mul(g,v),w=n.add(w,m),m=n.sub(y,m),m=n.mul(p,m),v=n.add(v,m),y=n.mul(w,v),d=n.add(d,y),y=n.mul(E,v),l=n.mul(b,l),l=n.sub(l,y),y=n.mul(b,w),h=n.mul(E,h),h=n.add(h,y),new f(l,d,h)}subtract(e){return this.add(e.negate())}is0(){return this.equals(f.ZERO)}wNAF(e){return h.wNAFCached(this,l,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(f.fromAffine)}))}multiplyUnsafe(e){const r=f.ZERO;if(e===vt)return r;if(a(e),e===Et)return this;const{endo:o}=t;if(!o)return h.unsafeLadder(this,e);let{k1neg:i,k1:s,k2neg:c,k2:l}=o.splitScalar(e),u=r,d=r,p=this;for(;s>vt||l>vt;)s&Et&&(u=u.add(p)),l&Et&&(d=d.add(p)),p=p.double(),s>>=Et,l>>=Et;return i&&(u=u.negate()),c&&(d=d.negate()),d=new f(n.mul(d.px,o.beta),d.py,d.pz),u.add(d)}multiply(e){a(e);let r,o,i=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(i);let{p:l,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);l=h.constTimeNegate(e,l),d=h.constTimeNegate(a,d),d=new f(n.mul(d.px,s.beta),d.py,d.pz),r=l.add(d),o=u.add(p)}else{const{p:e,f:t}=this.wNAF(i);r=e,o=t}return f.normalizeZ([r,o])[0]}multiplyAndAddUnsafe(e,t,n){const r=f.BASE,o=(e,t)=>t!==vt&&t!==Et&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),i=o(this,t).add(o(e,n));return i.is0()?void 0:i}toAffine(e){const{px:t,py:r,pz:o}=this,i=this.is0();null==e&&(e=i?n.ONE:n.inv(o));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(o,e);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===Et)return!0;if(n)return n(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===Et?this:n?n(f,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(f,this,e)}toHex(e=!0){return Le(this.toRawBytes(e))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,h=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,o=t;for(;n>pt;)n&gt&&(r=r.add(o)),o=o.double(),n>>=gt;return r},precomputeWindow(e,t){const{windows:n,windowSize:o}=r(t),i=[];let s=e,a=s;for(let r=0;r<n;r++){a=s,i.push(a);for(let e=1;e<o;e++)a=a.add(s),i.push(a);s=a.double()}return i},wNAF(t,o,i){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,l=e.BASE;const u=BigInt(2**t-1),f=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(i&u);i>>=d,r>a&&(r-=f,i+=gt);const s=t,h=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?l=l.add(n(p,o[s])):c=c.add(n(g,o[h]))}return{p:c,f:l}},wNAFCached(e,t,n,r){const o=e._WINDOW_SIZE||1;let i=t.get(e);return i||(i=this.precomputeWindow(e,o),1!==o&&t.set(e,r(i))),this.wNAF(o,i,n)}}}(f,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:s}}function kt(e){const t=function(e){const t=yt(e);return Je(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(e){return it(e,r)}function a(e){return ct(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:l,weierstrassEquation:u,isWithinCurveOrder:f}=At({...t,toBytes(e,t,r){const o=t.toAffine(),i=n.toBytes(o.x),s=Ve;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),i):s(Uint8Array.from([4]),i,n.toBytes(o.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==o||2!==r&&3!==r){if(t===i&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}{const e=je(s);if(!(vt<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let o=n.sqrt(t);return 1==(1&r)!==((o&Et)===Et)&&(o=n.neg(o)),{x:e,y:o}}var a}}),d=e=>Le(De(e,t.nByteLength));function h(e){return e>r>>Et}const p=(e,t,n)=>je(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=Me("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=bt.toSig(Me("DER",e));return new g(t,n)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:o,recovery:i}=this,l=b(Me("msgHash",e));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const u=2===i||3===i?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const f=0==(1&i)?"02":"03",h=c.fromHex(f+d(u)),p=a(u),g=s(-l*p),y=s(o*p),w=c.BASE.multiplyAndAddUnsafe(h,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Ue(this.toDERHex())}toDERHex(){return bt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ue(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return l(e),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const e=ht(t.n);return function(e,t,n=!1){const r=e.length,o=dt(t),i=ht(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=it(n?je(e):He(e),t-Xe)+Xe;return n?qe(s,o):De(s,o)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===o||r===i:n?r===2*o||r===2*i:e instanceof c}const m=t.bits2int||function(e){const n=je(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return s(m(e))},v=Fe(t.nBitLength);function E(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(vt<=e&&e<v))throw new Error(`bigint expected < 2^${t.nBitLength}`);return De(e,t.nByteLength)}function x(e,r,o=A){if(["recovered","canonical"].some((e=>e in o)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:y}=o;null==d&&(d=!0),e=Me("msgHash",e),p&&(e=Me("prehashed msgHash",i(e)));const w=b(e),v=l(r),x=[E(v),E(w)];if(null!=y){const e=!0===y?u(n.BYTES):y;x.push(Me("extraEntropy",e))}const k=Ve(...x),S=w;return{seed:k,k2sig:function(e){const t=m(e);if(!f(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),o=s(r.x);if(o===vt)return;const i=s(n*s(S+o*v));if(i===vt)return;let l=(r.x===o?0:2)|Number(r.y&Et),u=i;return d&&h(i)&&(u=function(e){return h(e)?s(-e):e}(i),l^=1),new g(o,u,l)}}}const A={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(l(e)).toRawBytes(n)},sign:function(e,n,r=A){const{seed:o,k2sig:i}=x(e,n,r),s=t;return Ze(s.hash.outputLen,s.nByteLength,s.hmac)(o,i)},verify:function(e,n,r,o=k){var i;const l=e;if(n=Me("msgHash",n),r=Me("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:f}=o;let d,h;try{if("string"==typeof l||l instanceof Uint8Array)try{d=g.fromDER(l)}catch(A){if(!(A instanceof bt.Err))throw A;d=g.fromCompact(l)}else{if("object"!=typeof l||"bigint"!=typeof l.r||"bigint"!=typeof l.s)throw new Error("PARSE");{const{r:e,s:t}=l;d=new g(e,t)}}h=c.fromHex(r)}catch(S){if("PARSE"===S.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;f&&(n=t.hash(n));const{r:p,s:y}=d,w=b(n),m=a(y),v=s(w*m),E=s(p*m),x=null==(i=c.BASE.multiplyAndAddUnsafe(h,v,E))?void 0:i.toAffine();return!!x&&s(x.x)===p},ProjectivePoint:c,Signature:g,utils:y}}BigInt(4);class St extends ve{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");de(e.outputLen),de(e.blockLen)}(e);const n=be(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?e.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=e.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(e){return pe(this),this.iHash.update(e),this}digestInto(e){pe(this),he(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:s}=this;return e.finished=r,e.destroyed=o,e.blockLen=i,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Bt=(e,t,n)=>new St(e,t).update(n).digest();
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function $t(e){return{hash:e,hmac:(t,...n)=>Bt(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!ye(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:xe}}Bt.create=(e,t)=>new St(e,t);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const zt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ot=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_t=BigInt(1),Tt=BigInt(2),It=(e,t)=>(e+t/Tt)/t;function Ct(e){const t=zt,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,f=at(u,n,t)*u%t,d=at(f,n,t)*u%t,h=at(d,Tt,t)*l%t,p=at(h,o,t)*h%t,g=at(p,i,t)*p%t,y=at(g,a,t)*g%t,w=at(y,c,t)*y%t,m=at(w,a,t)*g%t,b=at(m,n,t)*u%t,v=at(b,s,t)*p%t,E=at(v,r,t)*l%t,x=at(E,Tt,t);if(!Pt.eql(Pt.sqr(x),e))throw new Error("Cannot find square root");return x}const Pt=function(e,t,n=!1,r={}){if(e<=Qe)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=ft(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=lt(e),a=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:Fe(o),ZERO:Qe,ONE:Xe,create:t=>it(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Qe<=t&&t<e},is0:e=>e===Qe,isOdd:e=>(e&Xe)===Xe,neg:t=>it(-t,e),eql:(e,t)=>e===t,sqr:t=>it(t*t,e),add:(t,n)=>it(t+n,e),sub:(t,n)=>it(t-n,e),mul:(t,n)=>it(t*n,e),pow:(e,t)=>function(e,t,n){if(n<Qe)throw new Error("Expected power > 0");if(n===Qe)return e.ONE;if(n===Xe)return t;let r=e.ONE,o=t;for(;n>Qe;)n&Xe&&(r=e.mul(r,o)),o=e.sqr(o),n>>=Xe;return r}(a,e,t),div:(t,n)=>it(t*ct(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>ct(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,o)=>e.is0(r)?t:(n[o]=t,e.mul(t,r))),e.ONE),o=e.inv(r);return t.reduceRight(((t,r,o)=>e.is0(r)?t:(n[o]=e.mul(t,n[o]),e.mul(t,r))),o),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?qe(e,i):De(e,i),fromBytes:e=>{if(e.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${e.length}`);return n?He(e):je(e)}});return Object.freeze(a)}(zt,void 0,void 0,{sqrt:Ct}),Lt=function(e,t){const n=t=>kt({...e,...$t(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Pt,n:Ot,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Ot,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_t*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),a=It(i*e,t),c=It(-r*e,t);let l=it(e-a*n-c*o,t),u=it(-a*r-c*i,t);const f=l>s,d=u>s;if(f&&(l=t-l),d&&(u=t-u),l>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:l,k2neg:d,k2:u}}}},Oe),Rt=BigInt(0),Nt=e=>"bigint"==typeof e&&Rt<e&&e<zt,Ut=e=>"bigint"==typeof e&&Rt<e&&e<Ot,jt={};function Ht(e,...t){let n=jt[e];if(void 0===n){const t=Oe(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=Ve(t,t),jt[e]=n}return Oe(Ve(n,...t))}const Dt=e=>e.toRawBytes(!0).slice(1),qt=e=>De(e,32),Mt=e=>it(e,zt),Vt=e=>it(e,Ot),Ft=Lt.ProjectivePoint,Wt=(e,t,n)=>Ft.BASE.multiplyAndAddUnsafe(e,t,n);function Kt(e){let t=Lt.utils.normPrivateKeyToScalar(e),n=Ft.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Vt(-t),bytes:Dt(n)}}function Zt(e){if(!Nt(e))throw new Error("bad x: need 0 < x < p");const t=Mt(e*e);let n=Ct(Mt(t*e+BigInt(7)));n%Tt!==Rt&&(n=Mt(-n));const r=new Ft(e,n,_t);return r.assertValidity(),r}function Gt(...e){return Vt(je(Ht("BIP0340/challenge",...e)))}function Jt(e){return Kt(e).bytes}function Yt(e,t,n=xe(32)){const r=Me("message",e),{bytes:o,scalar:i}=Kt(t),s=Me("auxRand",n,32),a=qt(i^je(Ht("BIP0340/aux",s))),c=Ht("BIP0340/nonce",a,o,r),l=Vt(je(c));if(l===Rt)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=Kt(l),d=Gt(u,o,r),h=new Uint8Array(64);if(h.set(u,0),h.set(qt(Vt(f+d*i)),32),!Qt(h,r,o))throw new Error("sign: Invalid signature produced");return h}function Qt(e,t,n){const r=Me("signature",e,64),o=Me("message",t),i=Me("publicKey",n,32);try{const e=Zt(je(i)),t=je(r.subarray(0,32));if(!Nt(t))return!1;const n=je(r.subarray(32,64));if(!Ut(n))return!1;const s=Gt(qt(t),Dt(e),o),a=Wt(e,n,Vt(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==t)}catch(s){return!1}}const Xt=(()=>({getPublicKey:Jt,sign:Yt,verify:Qt,utils:{randomPrivateKey:Lt.utils.randomPrivateKey,lift_x:Zt,pointToBytes:Dt,numberToBytesBE:De,bytesToNumberBE:je,taggedHash:Ht,mod:it}}))(),en=e=>e instanceof Uint8Array,tn=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),nn=(e,t)=>e<<32-t|e>>>t;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const rn=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function on(e){if(!en(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=rn[e[n]];return t}function sn(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const t=2*r,o=e.slice(t,t+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function an(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!en(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class cn{clone(){return this._cloneInto()}}function ln(e){const t=t=>e().update(an(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function un(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function fn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const dn={number:un,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:fn,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");un(e.outputLen),un(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){fn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class hn extends cn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=tn(this.buffer)}update(e){dn.exists(this);const{view:t,buffer:n,blockLen:r}=this,o=(e=an(e)).length;for(let i=0;i<o;){const s=Math.min(r-this.pos,o-i);if(s!==r)n.set(e.subarray(i,i+s),this.pos),this.pos+=s,i+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=tn(e);for(;r<=o-i;i+=r)this.process(t,i)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){dn.exists(this),dn.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;t[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let u=i;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),a=Number(n&i),c=r?4:0,l=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+l,a,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const s=tn(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<c;u++)s.setUint32(4*u,l[u],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:o,destroyed:i,pos:s}=this;return e.length=r,e.pos=s,e.finished=o,e.destroyed=i,r%t&&e.buffer.set(n),e}}const pn=(e,t,n)=>e&t^e&n^t&n,gn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),yn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wn=new Uint32Array(64);class mn extends hn{constructor(){super(64,32,8,!1),this.A=0|yn[0],this.B=0|yn[1],this.C=0|yn[2],this.D=0|yn[3],this.E=0|yn[4],this.F=0|yn[5],this.G=0|yn[6],this.H=0|yn[7]}get(){const{A:e,B:t,C:n,D:r,E:o,F:i,G:s,H:a}=this;return[e,t,n,r,o,i,s,a]}set(e,t,n,r,o,i,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|s,this.H=0|a}process(e,t){for(let f=0;f<16;f++,t+=4)wn[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const e=wn[f-15],t=wn[f-2],n=nn(e,7)^nn(e,18)^e>>>3,r=nn(t,17)^nn(t,19)^t>>>10;wn[f]=r+wn[f-7]+n+wn[f-16]|0}let{A:n,B:r,C:o,D:i,E:s,F:a,G:c,H:l}=this;for(let f=0;f<64;f++){const e=l+(nn(s,6)^nn(s,11)^nn(s,25))+((u=s)&a^~u&c)+gn[f]+wn[f]|0,t=(nn(n,2)^nn(n,13)^nn(n,22))+pn(n,r,o)|0;l=c,c=a,a=s,s=i+e|0,i=o,o=r,r=n,n=e+t|0}var u;n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,r,o,i,s,a,c,l)}roundClean(){wn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class bn extends mn{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const vn=ln((()=>new mn));ln((()=>new bn));var En=Symbol("verified"),xn=e=>e instanceof Object;new TextDecoder("utf-8");var An=new TextEncoder;function kn(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}var Sn=class{constructor(e){t(this,"value"),t(this,"next",null),t(this,"prev",null),this.value=e}},Bn=class{constructor(){t(this,"first"),t(this,"last"),this.first=null,this.last=null}enqueue(e){const t=new Sn(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function $n(e){if(!function(e){if(!xn(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function zn(e){return on(vn(An.encode($n(e))))}var On=new class{generateSecretKey(){return Xt.utils.randomPrivateKey()}getPublicKey(e){return on(Xt.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=on(Xt.getPublicKey(t)),n.id=zn(n),n.sig=on(Xt.sign(zn(n),t)),n[En]=!0,n}verifyEvent(e){if("boolean"==typeof e[En])return e[En];const t=zn(e);if(t!==e.id)return e[En]=!1,!1;try{const n=Xt.verify(e.sig,t,e.pubkey);return e[En]=n,n}catch(n){return e[En]=!1,!1}}};On.generateSecretKey,On.getPublicKey,On.finalizeEvent;var _n=On.verifyEvent;function Tn(e,t){if(e.ids&&-1===e.ids.indexOf(t.id)&&!e.ids.some((e=>t.id.startsWith(e))))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey)&&!e.authors.some((e=>t.pubkey.startsWith(e))))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}async function In(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}var Cn,Pn=e=>(e[En]=!0,!0);try{Cn=WebSocket}catch{}var Ln=class{constructor(e,n){t(this,"url"),t(this,"_connected",!1),t(this,"onclose",null),t(this,"onnotice",(e=>console.debug(`NOTICE from ${this.url}: ${e}`))),t(this,"_onauth",null),t(this,"baseEoseTimeout",4400),t(this,"connectionTimeout",4400),t(this,"openSubs",new Map),t(this,"connectionTimeoutHandle"),t(this,"connectionPromise"),t(this,"openCountRequests",new Map),t(this,"openEventPublishes",new Map),t(this,"ws"),t(this,"incomingMessageQueue",new Bn),t(this,"queueRunning",!1),t(this,"challenge"),t(this,"serial",0),t(this,"verifyEvent"),this.url=kn(e),this.verifyEvent=n.verifyEvent}static async connect(e,t){const n=new Ln(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{var e;t("connection timed out"),this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new Cn(this.url)}catch(n){return void t(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{var n;t(e.message),this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(n=this.onclose)||n.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var e;this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await In();this.queueRunning=!1}handleNext(){var e,t,n;const r=this.incomingMessageQueue.dequeue();if(!r)return!1;const o=function(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(-1===o)return null;let i=r+1+o;return e.slice(r+1,i)}(r);if(o){const n=this.openSubs.get(o);if(!n)return;const i=function(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}(r,"id"),s=null==(e=n.alreadyHaveEvent)?void 0:e.call(n,i);if(null==(t=n.receivedEvent)||t.call(n,this,i),s)return}try{let e=JSON.parse(r);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(Tn(e[n],t))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return n?o.resolve(r):o.reject(new Error(r)),void this.openEventPublishes.delete(t)}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void(null==(n=this._onauth)||n.call(this,e[1]))}}catch(i){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{var t;null==(t=this.ws)||t.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e((n=this.url,r=this.challenge,{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",r]],content:""}));var n,r;const o=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),o}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(null==t?void 0:t.id)||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e)+"]"),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new Rn(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,null==(e=this.ws)||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Rn=class{constructor(e,n,r,o){t(this,"relay"),t(this,"id"),t(this,"closed",!1),t(this,"eosed",!1),t(this,"filters"),t(this,"alreadyHaveEvent"),t(this,"receivedEvent"),t(this,"onevent"),t(this,"oneose"),t(this,"onclose"),t(this,"eoseTimeout"),t(this,"eoseTimeoutHandle"),this.relay=e,this.filters=r,this.id=n,this.alreadyHaveEvent=o.alreadyHaveEvent,this.receivedEvent=o.receivedEvent,this.eoseTimeout=o.eoseTimeout||e.baseEoseTimeout,this.oneose=o.oneose,this.onclose=o.onclose,this.onevent=o.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,null==(e=this.oneose)||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),null==(t=this.onclose)||t.call(this,e)}},Nn=class{constructor(e){t(this,"relays",new Map),t(this,"seenOn",new Map),t(this,"trackRelays",!1),t(this,"verifyEvent"),t(this,"trustedRelayURLs",new Set),this.verifyEvent=e.verifyEvent}async ensureRelay(e,t){e=kn(e);let n=this.relays.get(e);return n||(n=new Ln(e,{verifyEvent:this.trustedRelayURLs.has(e)?Pn:this.verifyEvent}),(null==t?void 0:t.connectionTimeout)&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(kn).forEach((e=>{var t;null==(t=this.relays.get(e))||t.close()}))}subscribeMany(e,t,n){this.trackRelays&&(n.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e)});const r=new Set,o=[],i=[];let s=t=>{var r;i[t]=!0,i.filter((e=>e)).length===e.length&&(null==(r=n.oneose)||r.call(n),s=()=>{})};const a=[];let c=(t,r)=>{var o;s(t),a[t]=r,a.filter((e=>e)).length===e.length&&(null==(o=n.onclose)||o.call(n,a),c=()=>{})};const l=e=>{var t;if(null==(t=n.alreadyHaveEvent)?void 0:t.call(n,e))return!0;const o=r.has(e);return r.add(e),o},u=Promise.all(e.map(kn).map((async(e,r,i)=>{if(i.indexOf(e)!==r)return void c(r,"duplicate url");let a;try{a=await this.ensureRelay(e,{connectionTimeout:n.maxWait?Math.max(.8*n.maxWait,n.maxWait-1e3):void 0})}catch(f){return void c(r,(null==f?void 0:f.message)||String(f))}let u=a.subscribe(t,{...n,oneose:()=>s(r),onclose:e=>c(r,e),alreadyHaveEvent:l,eoseTimeout:n.maxWait});o.push(u)})));return{async close(){await u,o.forEach((e=>{e.close()}))}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise((async r=>{const o=[];this.subscribeManyEose(e,[t],{...n,onevent(e){o.push(e)},onclose(e){r(o)}})}))}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort(((e,t)=>t.created_at-e.created_at)),r[0]||null}publish(e,t){return e.map(kn).map((async(e,n,r)=>{if(r.indexOf(e)!==n)return Promise.reject("duplicate url");return(await this.ensureRelay(e)).publish(t)}))}};const Un=Symbol("store-raw"),jn=Symbol("store-node"),Hn=Symbol("store-has"),Dn=Symbol("store-self");function qn(e){let t=e[n];if(!t&&(Object.defineProperty(e,n,{value:t=new Proxy(e,Gn)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let o=0,i=n.length;o<i;o++){const i=n[o];r[i].get&&Object.defineProperty(e,i,{enumerable:r[i].enumerable,get:r[i].get.bind(t)})}}return t}function Mn(e){let t;return null!=e&&"object"==typeof e&&(e[n]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Vn(e,t=new Set){let n,r,o,i;if(n=null!=e&&e[Un])return n;if(!Mn(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let n=0,i=e.length;n<i;n++)o=e[n],(r=Vn(o,t))!==o&&(e[n]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const n=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let a=0,c=n.length;a<c;a++)i=n[a],s[i].get||(o=e[i],(r=Vn(o,t))!==o&&(e[i]=r))}return e}function Fn(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Wn(e,t,n){if(e[t])return e[t];const[r,o]=m(n,{equals:!1,internal:!0});return r.$=o,e[t]=r}function Kn(e){z()&&Wn(Fn(e,jn),Dn)()}function Zn(e){return Kn(e),Reflect.ownKeys(e)}const Gn={get(e,t,o){if(t===Un)return e;if(t===n)return o;if(t===r)return Kn(e),o;const i=Fn(e,jn),s=i[t];let a=s?s():e[t];if(t===jn||t===Hn||"__proto__"===t)return a;if(!s){const n=Object.getOwnPropertyDescriptor(e,t);!z()||"function"==typeof a&&!e.hasOwnProperty(t)||n&&n.get||(a=Wn(i,t,a)())}return Mn(a)?qn(a):a},has:(e,t)=>t===Un||t===n||t===r||t===jn||t===Hn||"__proto__"===t||(z()&&Wn(Fn(e,Hn),t)(),t in e),set:()=>!0,deleteProperty:()=>!0,ownKeys:Zn,getOwnPropertyDescriptor:function(e,t){const r=Reflect.getOwnPropertyDescriptor(e,t);return r&&!r.get&&r.configurable&&t!==n&&t!==jn?(delete r.value,delete r.writable,r.get=()=>e[n][t],r):r}};function Jn(e,t,n,r=!1){if(!r&&e[t]===n)return;const o=e[t],i=e.length;void 0===n?(delete e[t],e[Hn]&&e[Hn][t]&&void 0!==o&&e[Hn][t].$()):(e[t]=n,e[Hn]&&e[Hn][t]&&void 0===o&&e[Hn][t].$());let s,a=Fn(e,jn);if((s=Wn(a,t,o))&&s.$((()=>n)),Array.isArray(e)&&e.length!==i){for(let t=e.length;t<i;t++)(s=a[t])&&s.$();(s=Wn(a,"length",i))&&s.$(e.length)}(s=a[Dn])&&s.$()}function Yn(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const o=n[r];Jn(e,o,t[o])}}function Qn(e,t,n=[]){let r,o=e;if(t.length>1){r=t.shift();const i=typeof r,s=Array.isArray(e);if(Array.isArray(r)){for(let o=0;o<r.length;o++)Qn(e,[r[o]].concat(t),n);return}if(s&&"function"===i){for(let o=0;o<e.length;o++)r(e[o],o)&&Qn(e,[o].concat(t),n);return}if(s&&"object"===i){const{from:o=0,to:i=e.length-1,by:s=1}=r;for(let r=o;r<=i;r+=s)Qn(e,[r].concat(t),n);return}if(t.length>1)return void Qn(e[r],t,[r].concat(n));o=e[r],n=[r].concat(n)}let i=t[0];"function"==typeof i&&(i=i(o,n),i===o)||void 0===r&&null==i||(i=Vn(i),void 0===r||Mn(o)&&Mn(i)&&!Array.isArray(i)?Yn(o,i):Jn(e,r,i))}function Xn(...[e,t]){const n=Vn(e||{}),r=Array.isArray(n);return[qn(n),function(...e){k((()=>{r&&1===e.length?function(e,t){if("function"==typeof t&&(t=t(e)),t=Vn(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const r=t[n];e[n]!==r&&Jn(e,n,r)}Jn(e,"length",r)}else Yn(e,t)}(n,e[0]):Qn(n,e)}))}]}const er={get(e,t,o){if(t===Un)return e;if(t===n)return o;if(t===r)return Kn(e),o;const i=Fn(e,jn),s=i[t];let a=s?s():e[t];if(t===jn||t===Hn||"__proto__"===t)return a;if(!s){const n=Object.getOwnPropertyDescriptor(e,t),r="function"==typeof a;if(!z()||r&&!e.hasOwnProperty(t)||n&&n.get){if(null!=a&&r&&a===Array.prototype[t])return(...e)=>k((()=>Array.prototype[t].apply(o,e)))}else a=Wn(i,t,a)()}return Mn(a)?tr(a):a},has:(e,t)=>t===Un||t===n||t===r||t===jn||t===Hn||"__proto__"===t||(z()&&Wn(Fn(e,Hn),t)(),t in e),set:(e,t,n)=>(k((()=>Jn(e,t,Vn(n)))),!0),deleteProperty:(e,t)=>(k((()=>Jn(e,t,void 0,!0))),!0),ownKeys:Zn,getOwnPropertyDescriptor:function(e,t){const r=Reflect.getOwnPropertyDescriptor(e,t);return!r||r.get||r.set||!r.configurable||t===n||t===jn||(delete r.value,delete r.writable,r.get=()=>e[n][t],r.set=r=>e[n][t]=r),r}};function tr(e){let t=e[n];if(!t){Object.defineProperty(e,n,{value:t=new Proxy(e,er)});const r=Object.keys(e),o=Object.getOwnPropertyDescriptors(e);for(let n=0,i=r.length;n<i;n++){const i=r[n];if(o[i].get){const n=o[i].get.bind(t);Object.defineProperty(e,i,{get:n})}if(o[i].set){const n=o[i].set,r=e=>k((()=>n.call(t,e)));Object.defineProperty(e,i,{set:r})}}}return t}function nr(e,t){return tr(Vn(e||{}))}const rr=Symbol("store-root");function or(e,t,n,r,o){const i=t[n];if(e===i)return;if(n!==rr&&(!Mn(e)||!Mn(i)||o&&e[o]!==i[o]))return void Jn(t,n,e);if(Array.isArray(e)){if(e.length&&i.length&&(!r||o&&e[0]&&null!=e[0][o])){let t,n,s,a,c,l,u,f;for(s=0,a=Math.min(i.length,e.length);s<a&&(i[s]===e[s]||o&&i[s]&&e[s]&&i[s][o]===e[s][o]);s++)or(e[s],i,s,r,o);const d=new Array(e.length),h=new Map;for(a=i.length-1,c=e.length-1;a>=s&&c>=s&&(i[a]===e[c]||o&&i[s]&&e[s]&&i[a][o]===e[c][o]);a--,c--)d[c]=i[a];if(s>c||s>a){for(n=s;n<=c;n++)Jn(i,n,e[n]);for(;n<e.length;n++)Jn(i,n,d[n]),or(e[n],i,n,r,o);return void(i.length>e.length&&Jn(i,"length",e.length))}for(u=new Array(c+1),n=c;n>=s;n--)l=e[n],f=o&&l?l[o]:l,t=h.get(f),u[n]=void 0===t?-1:t,h.set(f,n);for(t=s;t<=a;t++)l=i[t],f=o&&l?l[o]:l,n=h.get(f),void 0!==n&&-1!==n&&(d[n]=i[t],n=u[n],h.set(f,n));for(n=s;n<e.length;n++)n in d?(Jn(i,n,d[n]),or(e[n],i,n,r,o)):Jn(i,n,e[n])}else for(let t=0,n=e.length;t<n;t++)or(e[t],i,t,r,o);return void(i.length>e.length&&Jn(i,"length",e.length))}const s=Object.keys(e);for(let c=0,l=s.length;c<l;c++)or(e[s[c]],i,s[c],r,o);const a=Object.keys(i);for(let c=0,l=a.length;c<l;c++)void 0===e[a[c]]&&Jn(i,a[c],void 0)}function ir(e,t={}){const{merge:n,key:r="id"}=t,o=Vn(e);return e=>{if(!Mn(e)||!Mn(o))return o;const t=or(o,{[rr]:e},rr,n,r);return void 0===t?e:t}}const sr=new class extends Nn{constructor(){super({verifyEvent:_n})}},ar=nr({rootEventIds:[],filter:{},profiles:()=>[]}),cr=nr({}),lr=["reply","likes","zaps","publish","watch","replyAnonymously","hideContent"],ur=e=>lr.includes(e);
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function fr(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function dr(...e){const t=(e,t)=>n=>e(t(n));return{encode:Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),decode:e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0)}}function hr(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(fr(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function pr(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function gr(e,t="="){if(fr(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function yr(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function wr(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],i=Array.from(e);for(i.forEach((e=>{if(fr(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,s=!0;for(let o=r;o<i.length;o++){const a=i[o],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%n,i[o]=Math.floor(c/n),!Number.isSafeInteger(i[o])||i[o]*n+e!==c)throw new Error("convertRadix: carry overflow");s&&(i[o]?s=!1:r=o)}if(o.push(e),s)break}for(let s=0;s<e.length-1&&0===e[s];s++)o.push(0);return o.reverse()}const mr=(e,t)=>t?mr(t,e%t):e,br=(e,t)=>e+(t-mr(e,t));function vr(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(br(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${br(t,n)}`);let o=0,i=0;const s=2**n-1,a=[];for(const c of e){if(fr(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(o=o<<t|c,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)a.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&a.push(o>>>0),a}function Er(e,t=!1){if(fr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(br(8,e)>32||br(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return vr(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(vr(n,e,8,t))}}}function xr(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(n){}}}const Ar=dr(Er(4),hr("0123456789ABCDEF"),pr("")),kr=dr(Er(5),hr("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),gr(5),pr(""));dr(Er(5),hr("0123456789ABCDEFGHIJKLMNOPQRSTUV"),gr(5),pr("")),dr(Er(5),hr("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),pr(""),yr((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))));const Sr=dr(Er(6),hr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),gr(6),pr("")),Br=dr(Er(6),hr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),gr(6),pr("")),$r=e=>{return dr((fr(t=58),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return wr(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(wr(e,t,256))}}),hr(e),pr(""));var t},zr=$r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");$r("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),$r("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Or=[0,2,3,5,6,7,9,10,11],_r={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=zr.encode(r).padStart(Or[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=Or.indexOf(r.length),i=zr.decode(r);for(let e=0;e<i.length-o;e++)if(0!==i[e])throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(t)}},Tr=dr(hr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),pr("")),Ir=[996825010,642813549,513874426,1027748829,705979059];function Cr(e){const t=e>>25;let n=(33554431&e)<<5;for(let r=0;r<Ir.length;r++)1==(t>>r&1)&&(n^=Ir[r]);return n}function Pr(e,t,n=1){const r=e.length;let o=1;for(let i=0;i<r;i++){const t=e.charCodeAt(i);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);o=Cr(o)^t>>5}o=Cr(o);for(let i=0;i<r;i++)o=Cr(o)^31&e.charCodeAt(i);for(let i of t)o=Cr(o)^i;for(let i=0;i<6;i++)o=Cr(o);return o^=n,Tr.encode(vr([o%2**30],30,5,!1))}function Lr(e){const t="bech32"===e?1:734539939,n=Er(5),r=n.decode,o=n.encode,i=xr(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(e=r).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=e.slice(0,o),s=e.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=Tr.decode(s).slice(0,-6),c=Pr(i,a,t);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const o=e.length+7+n.length;if(!1!==r&&o>r)throw new TypeError(`Length ${o} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${Tr.encode(n)}${Pr(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:xr(s),fromWords:r,fromWordsUnsafe:i,toWords:o}}const Rr=Lr("bech32");Lr("bech32m");const Nr={utf8:{encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},hex:dr(Er(4),hr("0123456789abcdef"),pr(""),yr((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}))),base16:Ar,base32:kr,base64:Sr,base64url:Br,base58:zr,base58xmr:_r};Object.keys(Nr).join(", ");var Ur=new TextDecoder("utf-8");new TextEncoder;var jr=5e3;function Hr(e){var t,n,r,o,i,s,a,c;let{prefix:l,words:u}=Rr.decode(e,jr),f=new Uint8Array(Rr.fromWords(u));switch(l){case"nprofile":{let e=Dr(f);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:on(e[0][0]),relays:e[1]?e[1].map((e=>Ur.decode(e))):[]}}}case"nevent":{let e=Dr(f);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:on(e[0][0]),relays:e[1]?e[1].map((e=>Ur.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?on(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(on(e[3][0]),16):void 0}}}case"naddr":{let e=Dr(f);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ur.decode(e[0][0]),pubkey:on(e[2][0]),kind:parseInt(on(e[3][0]),16),relays:e[1]?e[1].map((e=>Ur.decode(e))):[]}}}case"nrelay":{let e=Dr(f);if(!(null==(c=e[0])?void 0:c[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Ur.decode(e[0][0])}}case"nsec":return{type:l,data:f};case"npub":case"note":return{type:l,data:on(f)};default:throw new Error(`unknown prefix ${l}`)}}function Dr(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}function qr(e){return Vr("npub",sn(e))}function Mr(e){return Vr("note",sn(e))}function Vr(e,t){return function(e,t){let n=Rr.toWords(t);return Rr.encode(e,n,jr)}(e,t)}var Fr=new TextDecoder("utf-8");new TextEncoder;var Wr=5e3;function Kr(e){var t,n,r,o,i,s,a,c;let{prefix:l,words:u}=Rr.decode(e,Wr),f=new Uint8Array(Rr.fromWords(u));switch(l){case"nprofile":{let e=Zr(f);if(!(null==(t=e[0])?void 0:t[0]))throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:on(e[0][0]),relays:e[1]?e[1].map((e=>Fr.decode(e))):[]}}}case"nevent":{let e=Zr(f);if(!(null==(n=e[0])?void 0:n[0]))throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:on(e[0][0]),relays:e[1]?e[1].map((e=>Fr.decode(e))):[],author:(null==(r=e[2])?void 0:r[0])?on(e[2][0]):void 0,kind:(null==(o=e[3])?void 0:o[0])?parseInt(on(e[3][0]),16):void 0}}}case"naddr":{let e=Zr(f);if(!(null==(i=e[0])?void 0:i[0]))throw new Error("missing TLV 0 for naddr");if(!(null==(s=e[2])?void 0:s[0]))throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!(null==(a=e[3])?void 0:a[0]))throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Fr.decode(e[0][0]),pubkey:on(e[2][0]),kind:parseInt(on(e[3][0]),16),relays:e[1]?e[1].map((e=>Fr.decode(e))):[]}}}case"nrelay":{let e=Zr(f);if(!(null==(c=e[0])?void 0:c[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Fr.decode(e[0][0])}}case"nsec":return{type:l,data:f};case"npub":case"note":return{type:l,data:on(f)};default:throw new Error(`unknown prefix ${l}`)}}function Zr(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],o=n.slice(2,2+r);if(n=n.slice(2+r),o.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(o)}return t}var Gr=new RegExp(`nostr:(${/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/.source})`),Jr=()=>new RegExp(`\\b${Gr.source}\\b`,"g");"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Yr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qr={exports:{}};Qr.exports=function(){function e(e){return e.replace(/\\([(){}[\]#*+\-.!_\\])/g,(function(e,t){return String.fromCharCode(1,n.indexOf(t)+r)})).replace(/(\*\*|__|~~)(\S(?:[\s\S]*?\S)?)\1/g,(function(e,t,n){return"~~"===t?"<del>"+n+"</del>":"<b>"+n+"</b>"})).replace(/(\n|^|\W)([_\*])(\S(?:[\s\S]*?\S)?)\2(\W|$|\n)/g,(function(e,t,n,r,o){return t+"<i>"+r+"</i>"+o})).replace(/(!?)\[([^\]<>]+)\]\((\+?)([^ \)<>]+)(?: "([^\(\)\"]+)")?\)/g,(function(e,t,n,r,i,s){var a=s?' title="'+s+'"':"";return t?'<img src="'+o.href(i)+'" alt="'+n+'"'+a+"/>":(r&&(a+=' target="_blank"'),'<a href="'+o.href(i)+'"'+a+">"+n+"</a>")}))}function t(e){return e.replace(/\x01([\x0f-\x1c])/g,(function(e,t){return n.charAt(t.charCodeAt(0)-r)}))}var n="\\[!]#{()}*+-._",r=16,o=function(n){return n.replace(/.+(?:\n.+)*/g,(function(n){var r=/^\s{4}([^]*)$/.exec(n);if(r)return"<pre><code>"+r[1].replace(/\n    /g,"\n")+"</code></pre>";for(var i,s=[],a=e(n).split("\n"),c=0,l=a.length;l>c;++c){var u=a[c],f=/^\s{0,3}(\#{1,6})\s+(.*?)\s*#*\s*$/.exec(u);if(f)s.push(i=[f[2],"h",f[1].length]);else{var d=/^(\s*)(?:[-*]|(\d[.)])) (.+)$/.exec(u);d?s.push(i=[d[3],d[2]?"ol":"ul",d[1].length]):/^\s{0,3}([-])(\s*\1){2,}\s*$/.test(u)?s.push(i=["","hr"]):i&&"hr"!==i[1]&&"h"!==i[1]?i[0]+="\n"+u:s.push(i=[u,"p",""])}}var h="",p=[];for(c=0,l=s.length;l>c;++c){var g=(i=s[c])[0],y=i[1],w=i[2];if("ul"===y||"ol"===y)!p.length||w>p[0][1]?(p.unshift([y,w]),h+="<"+p[0][0]+"><li>"+g):p.length>1&&w<=p[1][1]?(h+="</li></"+p.shift()[0]+">",--c):h+="</li><li>"+g;else{for(;p.length;)h+="</li></"+p.shift()[0]+">";h+="hr"===y?"<hr/>":"<"+y+w+o.headAttrs(w,g)+">"+g+"</"+y+w+">"}}for(;p.length;)h+="</li></"+p.shift()[0]+">";return t(h)}))};return o.href=function(e){return e},o.headAttrs=function(e,t){return""},o}();const Xr=Yr(Qr.exports);function eo(e,{delay:t}={}){if("number"!=typeof t&&void 0!==t)throw new TypeError(`Expected \`interval\` to be of type \`number\` but received type \`${typeof t}\``);const n=void 0===t?async()=>{}:(r=t,async()=>new Promise((e=>{setTimeout(e,r)})));var r;let o=[];return t=>{o.push(t),1===o.length&&(async()=>{await n(),e(o),o=[]})()}}const to=(e,t)=>t.some((t=>e instanceof t));let no,ro;const oo=new WeakMap,io=new WeakMap,so=new WeakMap,ao=new WeakMap,co=new WeakMap;let lo={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return io.get(e);if("objectStoreNames"===t)return e.objectStoreNames||so.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ho(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function uo(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ro||(ro=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(po(this),t),ho(oo.get(this))}:function(...t){return ho(e.apply(po(this),t))}:function(t,...n){const r=e.call(po(this),t,...n);return so.set(r,t.sort?t.sort():[t]),ho(r)}}function fo(e){return"function"==typeof e?uo(e):(e instanceof IDBTransaction&&function(e){if(io.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));io.set(e,t)}(e),to(e,no||(no=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,lo):e)}function ho(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(ho(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&oo.set(t,e)})).catch((()=>{})),co.set(t,e),t}(e);if(ao.has(e))return ao.get(e);const t=fo(e);return t!==e&&(ao.set(e,t),co.set(t,e)),t}const po=e=>co.get(e);const go=["get","getKey","getAll","getAllKeys","count"],yo=["put","add","delete","clear"],wo=new Map;function mo(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(wo.get(t))return wo.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=yo.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!go.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),o&&i.done]))[0]};return wo.set(t,i),i}lo=(e=>({...e,get:(t,n,r)=>mo(t,n)||e.get(t,n,r),has:(t,n)=>!!mo(t,n)||e.has(t,n)}))(lo);const bo={events:"id",aggregates:["eid","k"],profiles:["pk"],relays:["n","a"]},vo=async(e,t)=>{if(t<=1){const t=[...e.objectStoreNames];await Promise.all(t.map((t=>e.deleteObjectStore(t))))}const n=e.createObjectStore("events",{keyPath:bo.events});n.createIndex("a","a"),n.createIndex("ro","ro"),n.createIndex("r","r"),n.createIndex("d","d"),n.createIndex("k","k"),e.createObjectStore("aggregates",{keyPath:bo.aggregates});e.createObjectStore("profiles",{keyPath:bo.profiles}).createIndex("l","l");e.createObjectStore("relays",{keyPath:bo.relays}).createIndex("a","a")},Eo=e=>{var t,n;const r=function(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){const e=n[r],[o,i,s,a]=e,c={id:i,relays:s?[s]:[]},l=0===r,u=r===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?l?t.root=c:u?t.reply=c:t.mentions.push(c):t.mentions.push(c):t.reply=c:t.root=c}return t}(e),o=e.tags.find((e=>"a"===e[0])),i=o&&o[1],s=o&&"mention"===o[3],a=e.tags.find((e=>"r"===e[0])),c=a&&a[1],l=e.tags.filter((e=>"t"===e[0])),u=[...new Set(l.map((e=>e[1])))],f=e.tags.find((e=>"d"===e[0])),d=f&&f[1],h=e.tags.find((e=>"title"===e[0])),p=h&&h[1];return{id:e.id??"",k:e.kind,c:e.content,ts:e.created_at,pk:e.pubkey,ro:null==(t=r.root)?void 0:t.id,re:null==(n=r.reply)?void 0:n.id,me:r.mentions.map((e=>e.id)),p:r.profiles.map((e=>e.pubkey)),a:i,am:s,r:c,t:u,d:d,tl:p}};let xo,Ao={},ko=!0;const So=async()=>{if(!1!==ko)try{return xo||(xo=await function(e,t,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const s=indexedDB.open(e,t),a=ho(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(ho(s.result),e.oldVersion,e.newVersion,ho(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("zapthreads",2,{upgrade:vo}))}catch(e){ko=!1}},Bo=e=>{const t=x(B(e,(()=>{const[t,n,r]=e(),[o,{mutate:i}]=A((()=>Po[t]),(()=>zo(t,n,r)),{initialValue:[],storage:Lo});return zo(t,n,r).then(i),o})));return()=>t()()},$o=e=>{const t=x(B(e,(()=>{const[t,n,r]=e(),[o,{mutate:i}]=A((()=>Po[t]),(()=>Oo(t,n,r)),{initialValue:void 0,storage:Lo});return Oo(t,n,r).then(i),o})));return()=>t()()},zo=async(e,t,n)=>{const r=await So();if(!r){const r=Ao[e];if(r){if(n){const e=Array.isArray(t)?t:[t];return Object.values(r).filter((t=>e.includes(t[n.index])))}return Object.values(r)}return[]}if(t&&n){if(Array.isArray(t)){const o=t.map((t=>r.getAllFromIndex(e,n.index,t)));return(await Promise.all(o)).flat()}return r.getAllFromIndex(e,n.index,t)}return r.getAll(e)},Oo=async(e,t,n)=>{const r=await So();if(r)return n?r.getFromIndex(e,n.index,t):r.get(e,t);{const r=Ao[e];if(r){if(n)return Object.values(r).find((e=>e[n.index]===t));return r[(t.lower?t.lower:t).toString()]}}},_o={},To=(e,t)=>{Ao[e]??(Ao[e]={});for(const n of t){let t=bo[e];t=Array.isArray(t)?t:[t];const r=t.map((e=>n[e])).join(",");Ao[e][r]=n}},Io=async(e,t,n={immediate:!1})=>{const r=await So();if(n.immediate)return r?r.put(e,t):To(e,[t]),void(Po[e]=+new Date);_o[e]||(_o[e]=eo((async t=>{if(!r)return To(e,t),void(Po[e]=+new Date);const n=r.transaction(e,"readwrite");await Promise.all([...t.map((e=>n.store.put(e))),n.done])&&(Po[e]=+new Date)}),{delay:96})),_o[e](t)},Co=async()=>{const e=await So();if(!e)return void(Ao={});const t=[...e.objectStoreNames];await Promise.all(t.map((t=>e.clear(t))))},Po=nr({});function Lo(e){const[t,n]=Xn({value:e});return[()=>t.value,e=>{const r=Vn(t.value);return"function"==typeof e&&(e=e(r)),n("value",ir(e)),t.value}]}const Ro=async(e,t,n)=>{const r=+new Date,o=[...new Set(e)].filter((e=>{const t=n.find((t=>t.pk===e));return!((null==t?void 0:t.l)&&t.l>r-216e5)})).filter((e=>!!e));if(0===o.length)return;const i=await sr.querySync(t,{kinds:[0],authors:o});for(const s of o){const e=i.find((e=>e.pubkey===s));if(e){const t=JSON.parse(e.content),o=e.pubkey,i={pk:o,ts:e.created_at,i:t.image||t.picture,n:t.displayName||t.display_name||t.name},s=n.find((e=>e.pk===o));!s||!(null==s?void 0:s.n)||s.ts<i.ts?Io("profiles",{...i,l:r}):Io("profiles",{...s,l:r})}}},No=new RegExp("(?<=^|\\s)https?:\\/\\/[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&\\/\\/=]*)","gi"),Uo=/(\S*(?:png|jpg|jpeg|gif|webp))/gi,jo=new RegExp("(?<=^|\\s)@?((naddr|npub|nevent|note)[a-z0-9]{20,})","g"),Ho=/\`(.*?)\`/g,Do=/\B\#([a-zA-Z0-9]+\b)(?!;)/g,qo=(e,t,n=[])=>{let r=e.c;const o=t.urlPrefixes,i=t.profiles;r=r.replace(No,(e=>e.match(Uo)?`![image](${e})`:`[${e}](${e})`));const s=[...new Set(e.t)];if(s.length>0){const e=new RegExp(`(^|\\s)\\#(${s.join("|")})`,"gi");r=r.replaceAll(e,`$1[#$2](${o.tag}$2)`)}return r=r.replaceAll(jo,"nostr:$1"),r=function(e,t){return e.replaceAll(Jr(),((e,n)=>t({uri:e,value:n,decoded:Kr(n)})))}(r,(({decoded:e,value:t})=>{switch(e.type){case"nprofile":let r=i().find((t=>t.pk===e.data.pubkey));return`[@${(null==r?void 0:r.n)||Vo(t)}](${o.nprofile}${t})`;case"npub":let s=i().find((t=>t.pk===e.data));return`[@${(null==s?void 0:s.n)||Vo(t)}](${o.npub}${t})`;case"note":return`[@${Vo(t)}](${o.note}${t})`;case"naddr":const a=e.data,c=n.find((e=>e.pk===a.pubkey&&e.d===a.identifier));return c&&c.tl?`[${c.tl}](${o.naddr}${t})`:`[@${Vo(t)}](${o.naddr}${t})`;case"nevent":return`[@${Vo(t)}](${o.nevent}${t})`;default:return t}})),r=r.replaceAll(Ho,"<code>$1</code>"),Xr(r.trim())},Mo=e=>{const t=[],n=function*(e){const t=e.matchAll(Jr());for(const r of t)try{const[e,t]=r;yield{uri:e,value:t,decoded:Kr(t),start:r.index,end:r.index+e.length}}catch(n){}}(e);for(const i of n){if("npub"===i.decoded.type&&t.push(["p",i.decoded.data]),"naddr"===i.decoded.type){const e=i.decoded.data;t.push(["a",`${e.kind}:${e.pubkey}:${e.identifier}`,"","mention"])}"nevent"===i.decoded.type&&t.push(["e",i.decoded.data.id]),"note"===i.decoded.type&&t.push(["e",i.decoded.data])}const r=e.matchAll(Do),o=new Set([...r].map((e=>e[1].toLowerCase())));for(const i of o)t.push(["t",i]);return t},Vo=e=>e.substring(0,8)+"..."+e.substring(e.length-4),Fo=e=>e.sort(((e,t)=>(e.ts||0)>=(t.ts||0)?-1:1)),Wo=20,Ko='data:image/svg+xml;utf-8,<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><circle cx="512" cy="512" r="512" fill="%23333" fill-rule="evenodd" /></svg>',Zo=e=>e.children.reduce(((e,t)=>e+Zo(t)),e.children.length),Go=/\/+$/,Jo=(e,t=!0)=>{const n=new URL(e);return n.hash="",t&&(n.pathname=n.pathname.replace(Go,"")),n.toString()},Yo=(e,t)=>{let n=e.map((e=>({...e,children:[]})));const r=new Set(n.filter((e=>{if(t){const n=t.id===(e.re||e.ro);return n&&(e.parent=t),n}return!n.find((t=>t.id===(e.re||e.ro)))})));n=n.filter((e=>!r.has(e)));for(let o of r)o.children.push(...Yo(n,o));return[...r]};var Qo=Symbol("verified"),Xo=e=>e instanceof Object;new TextDecoder("utf-8");var ei=new TextEncoder;function ti(e){if(!function(e){if(!Xo(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function ni(e){return on(vn(ei.encode(ti(e))))}var ri=new class{generateSecretKey(){return Xt.utils.randomPrivateKey()}getPublicKey(e){return on(Xt.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=on(Xt.getPublicKey(t)),n.id=ni(n),n.sig=on(Xt.sign(ni(n),t)),n[Qo]=!0,n}verifyEvent(e){if("boolean"==typeof e[Qo])return e[Qo];const t=ni(e);if(t!==e.id)return e[Qo]=!1,!1;try{const n=Xt.verify(e.sig,t,e.pubkey);return e[Qo]=n,n}catch(n){return e[Qo]=!1,!1}}},oi=ri.generateSecretKey,ii=ri.getPublicKey,si=ri.finalizeEvent;ri.verifyEvent;var ai=Symbol("verified"),ci=e=>e instanceof Object;new TextDecoder("utf-8");var li=new TextEncoder;var ui=class{constructor(e){t(this,"value"),t(this,"next",null),t(this,"prev",null),this.value=e}},fi=class{constructor(){t(this,"first"),t(this,"last"),this.first=null,this.last=null}enqueue(e){const t=new ui(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function di(e){if(!function(e){if(!ci(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function hi(e){return on(vn(li.encode(di(e))))}var pi=new class{generateSecretKey(){return Xt.utils.randomPrivateKey()}getPublicKey(e){return on(Xt.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=on(Xt.getPublicKey(t)),n.id=hi(n),n.sig=on(Xt.sign(hi(n),t)),n[ai]=!0,n}verifyEvent(e){if("boolean"==typeof e[ai])return e[ai];const t=hi(e);if(t!==e.id)return e[ai]=!1,!1;try{const n=Xt.verify(e.sig,t,e.pubkey);return e[ai]=n,n}catch(n){return e[ai]=!1,!1}}};pi.generateSecretKey,pi.getPublicKey,pi.finalizeEvent;var gi,yi=pi.verifyEvent;function wi(e,t){if(e.ids&&-1===e.ids.indexOf(t.id)&&!e.ids.some((e=>t.id.startsWith(e))))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey)&&!e.authors.some((e=>t.pubkey.startsWith(e))))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}async function mi(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}try{gi=WebSocket}catch{}var bi=class{constructor(e,n){t(this,"url"),t(this,"_connected",!1),t(this,"onclose",null),t(this,"onnotice",(e=>console.debug(`NOTICE from ${this.url}: ${e}`))),t(this,"_onauth",null),t(this,"baseEoseTimeout",4400),t(this,"connectionTimeout",4400),t(this,"openSubs",new Map),t(this,"connectionTimeoutHandle"),t(this,"connectionPromise"),t(this,"openCountRequests",new Map),t(this,"openEventPublishes",new Map),t(this,"ws"),t(this,"incomingMessageQueue",new fi),t(this,"queueRunning",!1),t(this,"challenge"),t(this,"serial",0),t(this,"verifyEvent"),this.url=function(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}(e),this.verifyEvent=n.verifyEvent}static async connect(e,t){const n=new bi(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{var e;t("connection timed out"),this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new gi(this.url)}catch(n){return void t(n)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{var n;t(e.message),this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(n=this.onclose)||n.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var e;this._connected&&(this._connected=!1,this.connectionPromise=void 0,null==(e=this.onclose)||e.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await mi();this.queueRunning=!1}handleNext(){var e,t,n;const r=this.incomingMessageQueue.dequeue();if(!r)return!1;const o=function(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(-1===o)return null;let i=r+1+o;return e.slice(r+1,i)}(r);if(o){const n=this.openSubs.get(o);if(!n)return;const i=function(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}(r,"id"),s=null==(e=n.alreadyHaveEvent)?void 0:e.call(n,i);if(null==(t=n.receivedEvent)||t.call(n,this,i),s)return}try{let e=JSON.parse(r);switch(e[0]){case"EVENT":{const t=this.openSubs.get(e[1]),n=e[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(wi(e[n],t))return!0;return!1}(t.filters,n)&&t.onevent(n))}case"COUNT":{const t=e[1],n=e[2],r=this.openCountRequests.get(t);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(t)))}case"EOSE":{const t=this.openSubs.get(e[1]);if(!t)return;return void t.receivedEose()}case"OK":{const t=e[1],n=e[2],r=e[3],o=this.openEventPublishes.get(t);return n?o.resolve(r):o.reject(new Error(r)),void this.openEventPublishes.delete(t)}case"CLOSED":{const t=e[1],n=this.openSubs.get(t);if(!n)return;return n.closed=!0,void n.close(e[2])}case"NOTICE":return void this.onnotice(e[1]);case"AUTH":return this.challenge=e[1],void(null==(n=this._onauth)||n.call(this,e[1]))}}catch(i){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{var t;null==(t=this.ws)||t.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e((n=this.url,r=this.challenge,{kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",r]],content:""}));var n,r;const o=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),o}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(null==t?void 0:t.id)||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e)+"]"),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new vi(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,null==(e=this.ws)||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},vi=class{constructor(e,n,r,o){t(this,"relay"),t(this,"id"),t(this,"closed",!1),t(this,"eosed",!1),t(this,"filters"),t(this,"alreadyHaveEvent"),t(this,"receivedEvent"),t(this,"onevent"),t(this,"oneose"),t(this,"onclose"),t(this,"eoseTimeout"),t(this,"eoseTimeoutHandle"),this.relay=e,this.filters=r,this.id=n,this.alreadyHaveEvent=o.alreadyHaveEvent,this.receivedEvent=o.receivedEvent,this.eoseTimeout=o.eoseTimeout||e.baseEoseTimeout,this.oneose=o.oneose,this.onclose=o.onclose,this.onevent=o.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,null==(e=this.oneose)||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),null==(t=this.onclose)||t.call(this,e)}},Ei=class extends bi{constructor(e){super(e,{verifyEvent:yi})}static async connect(e){const t=new Ei(e);return await t.connect(),t}};new TextDecoder("utf-8"),new TextEncoder;const xi=Z("<div class=ztr-comment-info-picture><img>"),Ai=Z("<div class=ztr-reply-form><textarea></textarea><div class=ztr-reply-controls>"),ki=Z("<span>Publishing is disabled"),Si=Z("<span class=ztr-reply-error>Error: "),Bi=Z('<svg class=ztr-spinner viewBox="0 0 50 50"><circle class=path cx=25 cy=25 r=20 fill=none stroke-width=5>'),$i=Z("<button class=ztr-reply-button>Reply as "),zi=Z("<button class=ztr-reply-button>Reply anonymously"),Oi=Z("<button class=ztr-reply-login-button>Log in"),_i=Z("<li class=ztr-comment-action-like><span> likes"),Ti=Z("<li class=ztr-comment-action-zap><span> sats"),Ii=Z("<div class=ztr-comment-new><div class=ztr-comment-body><ul class=ztr-comment-actions>"),Ci=e=>{const[t,n]=m(""),[r,o]=m(!1),[i,s]=m(),[a,c]=m(""),l=()=>ar.anchor,u=ar.profiles,f=()=>ar.relays;E((async()=>{if(cr.active){const e=cr.active.pk;let t=u().find((t=>t.pk===e));t||(t={pk:e,l:0,ts:0},await Io("profiles",t)),s(t),Ro([e],f(),u())}else s()}));const d=async(t,r)=>{var i;o(!1),n(""),c(r??""),await Io("events",Eo(t),{immediate:!0}),null==(i=e.onDone)||i.call(globalThis)},h=e=>{o(!1),c(`Error: ${e}`)},p=async n=>{let r;if(n)r=cr.active;else{if(!cr.anonymous){const e=oi();cr.anonymous={pk:ii(e),signEvent:async t=>({sig:si(t,e).sig})}}r=cr.anonymous}if(!(null==r?void 0:r.signEvent))return void h("Error: User has no signer!");const i=t().trim();if(!i)return;const s={kind:1,created_at:Math.round(Date.now()/1e3),content:i,pubkey:r.pk,tags:Mo(i)};if(ar.anchorAuthor!==s.pubkey&&s.tags.push(["p",ar.anchorAuthor]),ar.externalAuthor)try{const e=Hr(ar.externalAuthor).data;s.tags.push(["p",e])}catch(p){}if(e.replyTo){const t=await Oo("events",IDBKeyRange.only(e.replyTo));t&&(s.tags.push(["e",t.ro,"","root"]),t.pk!==s.pubkey&&s.tags.push(["p",t.pk])),s.tags.push(["e",e.replyTo,"","reply"])}else{const e=ar.version||ar.rootEventIds[0];if(e)s.tags.push(["e",e,"","root"]);else if("http"===l().type){const e=function(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}(l().value),t={pubkey:r.pk,created_at:Math.round(Date.now()/1e3),kind:8812,tags:[["r",e]],content:`Comments on ${e} ↴`},n={id:ni(t),...t,...await r.signEvent(t)};Io("events",Eo(n)),ar.disableFeatures.includes("publish")?console.log("Publishing root event disabled",n):sr.publish(f(),n),ar.filter={"#e":[n.id]},s.tags.push(["e",n.id,"","root"])}}"naddr"===l().type&&s.tags.push(["a",l().value,"","root"]);const a=ni(s),c=await r.signEvent(s),u={id:a,...s,...c};if(o(!0),console.log(JSON.stringify(u,null,2)),ar.disableFeatures.includes("publish"))setTimeout((()=>d(u)),1e3);else{const e=[];for(const t of f())try{const e=await Ei.connect(t);await e.publish(u)}catch(g){console.error(g),e.push(t)}if(e.length===f().length)h("Error: Your comment was not published to any relay");else{const t=`Published to ${e.length}/${f().length} relays (see console for more info)`,n=e.length>0?t:void 0;d(u,n)}e.length=0}},g=void 0!==e.replyTo;let y;return(e=>{E((()=>{const t=e();t&&setTimeout((()=>t.focus()))}))})((()=>g&&y)),(()=>{const e=Ai(),o=e.firstChild,s=o.nextSibling;o.addEventListener("change",(e=>n(e.target.value)));return"function"==typeof y?Y(y,o):y=o,o.autofocus=g,Q(s,(()=>{const e=x((()=>!!ar.disableFeatures.includes("publish")));return()=>e()&&ki()})(),null),Q(s,(()=>{const e=x((()=>!!a()));return()=>e()&&(()=>{const e=Si();return e.firstChild,Q(e,a,null),e})()})(),null),Q(s,V(W,{get when(){return!r()},get fallback(){return Bi()},get children(){const e=xi(),t=e.firstChild;return v((()=>{var e;return J(t,"src",(null==(e=i())?void 0:e.i)||Ko)})),e}}),null),Q(s,(()=>{const e=x((()=>!!i()));return()=>e()&&(()=>{const e=$i();return e.firstChild,e.$$click=()=>p(i()),Q(e,(()=>i().n||Vo(qr(i().pk))),null),v((()=>e.disabled=r())),e})()})(),null),Q(s,(()=>{const e=x((()=>!(i()||ar.disableFeatures.includes("replyAnonymously"))));return()=>e()&&(()=>{const e=zi();return e.$$click=()=>p(),v((()=>e.disabled=r())),e})()})(),null),Q(s,(()=>{const e=x((()=>!i()));return()=>e()&&(()=>{const e=Oi();return e.$$click=()=>(async()=>{if(!window.nostr)return void h("Error: No NIP-07 extension!");const e=await window.nostr.getPublicKey();cr.internal={pk:e,signEvent:async e=>window.nostr.signEvent(e)},c(""),cr.active=cr.internal})(),e})()})(),null),v((e=>{const t=r(),n=ar.replyPlaceholder||"Add your comment...";return t!==e._v$&&(o.disabled=e._v$=t),n!==e._v$2&&J(o,"placeholder",e._v$2=n),e}),{_v$:void 0,_v$2:void 0}),v((()=>o.value=t())),e})()},Pi=()=>{const e=()=>ar.anchor,t=$o((()=>["aggregates",IDBKeyRange.only([e().value,9735])])),n=$o((()=>["aggregates",IDBKeyRange.only([e().value,7])])),r=()=>{var e;return(null==(e=n())?void 0:e.ids.length)??0};return(()=>{const e=Ii(),n=e.firstChild,o=n.firstChild;return Q(o,V(W,{get when(){return!ar.disableFeatures.includes("likes")},get children(){const e=_i(),t=e.firstChild,n=t.firstChild;return Q(e,cs,t),Q(t,r,n),e}}),null),Q(o,V(W,{get when(){return!ar.disableFeatures.includes("zaps")},get children(){const e=Ti(),n=e.firstChild,r=n.firstChild;return Q(e,as,n),Q(n,(()=>{return(e=(null==(n=t())?void 0:n.sum)??0)<1e4?e.toString():e<1e6?Math.round(e/1e3)+"k":Math.round(e/1e6)+"M";var e,n}),r),e}}),null),Q(n,V(Ci,{}),null),e})()};function Li(e,...t){return"function"==typeof e?e(...t):e}G(["click"]);var Ri={width:null,height:null};function Ni(e){if(!e)return{...Ri};const{width:t,height:n}=e.getBoundingClientRect();return{width:t,height:n}}function Ui(e){const t="function"==typeof e,[n,r]=function(e){const t={...e},n={...e},r={},o=e=>{let n=r[e];if(!n){if(!z())return t[e];r[e]=n=m(t[e],{internal:!0}),delete t[e]}return n[0]()};for(const s in e)Object.defineProperty(n,s,{get:()=>o(s),enumerable:!0});const i=(e,n)=>{const o=r[e];if(o)return o[1](n);e in t&&(t[e]=Li(n,[t[e]]))};return[n,(e,t)=>{if(null===(r=e)||"object"!=typeof r&&"function"!=typeof r)i(e,t);else{const t=S((()=>Object.entries(Li(e,n))));k((()=>{for(const[e,n]of t)i(e,(()=>n))}))}var r;return n}]}(t?Ri:Ni(e)),o=new ResizeObserver((([e])=>r(Ni(e.target))));return $((()=>o.disconnect())),t?E((()=>{const t=e();t&&(r(Ni(t)),o.observe(t),$((()=>o.unobserve(t))))})):(o.observe(e),$((()=>o.unobserve(e)))),n}const ji=Z("<div class=ztr-thread>"),Hi=Z("<li class=ztr-comment-action-reply><span>"),Di=Z("<div class=ztr-comment><div class=ztr-comment-body><div class=ztr-comment-info-wrapper><div class=ztr-comment-info><div class=ztr-comment-info-picture><img></div><ul class=ztr-comment-info-items><li class=ztr-comment-info-author><a target=_blank></a><span style=white-space:nowrap;><strong> <!>ed</strong> </span></li><li><a class=ztr-comment-info-dots></a></li></ul></div><ul class=ztr-comment-info-items></ul></div><div class=ztr-comment-text></div><div class=ztr-comment-text></div><ul class=ztr-comment-actions>"),qi=Z("<li>●"),Mi=Z("<li> repl"),Vi=Z("<li><span>"),Fi=Z("<div class=ztr-info-pane><a target=_blank><small>Event data"),Wi=Z("<p class=warning><span>This is a <!> that referenced this article in <a>another thread"),Ki=Z("<p class=warning><span>Article contents may have changed since this <!> was made"),Zi=Z("<p class=warning><span>Article contents changed since this <!> was made"),Gi=Z("<div class=ztr-comment-expand><a></a><span>Show full comment"),Ji=Z("<div class=ztr-comment-replies>"),Yi=Z('<svg viewBox="0 -6 60 60"xmlns=http://www.w3.org/2000/svg><path d="M 12.6030 50.4905 C 13.3758 50.4905 13.9307 50.1140 14.8621 49.2421 L 20.6483 43.8720 C 19.5188 42.9803 18.6073 41.5733 18.6073 38.3433 L 18.6073 25.2052 C 18.6073 19.1217 22.3129 15.5152 28.3766 15.5152 L 42.2479 15.5152 L 42.2281 14.7622 C 41.9306 10.6999 39.2557 8.0643 34.7177 8.0643 L 7.5301 8.0643 C 2.9922 8.0643 0 10.7791 0 15.4954 L 0 34.9548 C 0 39.6710 2.9922 42.7028 7.5301 42.7028 L 10.8195 42.7028 L 10.8195 48.4693 C 10.8195 49.6979 11.4735 50.4905 12.6030 50.4905 Z M 44.6058 53.2450 C 45.7353 53.2450 46.3895 52.4325 46.3895 51.2237 L 46.3895 45.4374 L 48.4702 45.4374 C 53.0078 45.4374 56 42.4056 56 37.7092 L 56 25.6610 C 56 20.9250 53.0078 18.2300 48.4702 18.2300 L 28.8522 18.2300 C 24.1161 18.2300 21.3221 20.9250 21.3221 25.6610 L 21.3221 37.7092 C 21.3221 42.4056 24.1161 45.4374 28.8522 45.4374 L 35.1735 45.4374 L 42.3470 51.9767 C 43.2784 52.8487 43.8331 53.2450 44.6058 53.2450 Z">'),Qi=Z('<svg xmlns=http://www.w3.org/2000/svg viewBox="-120 -80 528 588"><path d="M349.4 44.6c5.9-13.7 1.5-29.7-10.6-38.5s-28.6-8-39.9 1.8l-256 224c-10 8.8-13.6 22.9-8.9 35.3S50.7 288 64 288H175.5L98.6 467.4c-5.9 13.7-1.5 29.7 10.6 38.5s28.6 8 39.9-1.8l256-224c10-8.8 13.6-22.9 8.9-35.3s-16.6-20.7-30-20.7H272.5L349.4 44.6z">'),Xi=Z('<svg viewBox="0 -16 180 180"xmlns=http://www.w3.org/2000/svg><path d="M60.732 29.7C41.107 29.7 22 39.7 22 67.41c0 27.29 45.274 67.29 74 94.89 28.744-27.6 74-67.6 74-94.89 0-27.71-19.092-37.71-38.695-37.71C116 29.7 104.325 41.575 96 54.066 87.638 41.516 76 29.7 60.732 29.7z">'),es=Z('<svg viewBox="0 0 576 512"><path d="M168 80c-13.3 0-24 10.7-24 24V408c0 8.4-1.4 16.5-4.1 24H440c13.3 0 24-10.7 24-24V104c0-13.3-10.7-24-24-24H168zM72 480c-39.8 0-72-32.2-72-72V112C0 98.7 10.7 88 24 88s24 10.7 24 24V408c0 13.3 10.7 24 24 24s24-10.7 24-24V104c0-39.8 32.2-72 72-72H440c39.8 0 72 32.2 72 72V408c0 39.8-32.2 72-72 72H72zM176 136c0-13.3 10.7-24 24-24h96c13.3 0 24 10.7 24 24v80c0 13.3-10.7 24-24 24H200c-13.3 0-24-10.7-24-24V136zm200-24h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H376c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80h32c13.3 0 24 10.7 24 24s-10.7 24-24 24H376c-13.3 0-24-10.7-24-24s10.7-24 24-24zM200 272H408c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24zm0 80H408c13.3 0 24 10.7 24 24s-10.7 24-24 24H200c-13.3 0-24-10.7-24-24s10.7-24 24-24z">'),ts=Z('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -200 560 640"><path d="M8 256a56 56 0 1 1 112 0A56 56 0 1 1 8 256zm160 0a56 56 0 1 1 112 0 56 56 0 1 1 -112 0zm216-56a56 56 0 1 1 0 112 56 56 0 1 1 0-112z">'),ns=Z('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -50 256 512"><path d="M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z">'),rs=Z('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 -50 320 512"><path d="M137.4 374.6c12.5 12.5 32.8 12.5 45.3 0l128-128c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8L32 192c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l128 128z">'),os=Z('<svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z">'),is=e=>{const t=ar.profiles;return(()=>{const n=ji();return Q(n,V(F,{get each(){return Fo(e.nestedEvents())},children:n=>{const[r,o]=m(!1),[i,s]=m(!1),[a,c]=m(!1),[l,u]=m(!1),[f,d]=m(),h=Ui(f),[p,g]=m(Ko),y=()=>n().pk,w=()=>qr(y()),b=()=>t().find((e=>e.pk===y()));let A;E((async()=>{var e;g((null==(e=b())?void 0:e.i)||Ko)}));const k=()=>(e=>{const t=new Date,n=Math.floor((t.getTime()-e)/1e3);if(n<60)return"now";if(n<3600){const e=Math.floor(n/60);return`${e} minute${1===e?"":"s"} ago`}if(n<=86400){const e=Math.floor(n/3600);return`${e} hour${1===e?"":"s"} ago`}if(n<=604800){const e=Math.floor(n/86400);return`${e} day${1===e?"":"s"} ago`}if(n>604800){const n=new Date(e);return"on "+n.toLocaleDateString("en-us",{day:"numeric",month:"long"})+(n.getFullYear()===t.getFullYear()?"":" "+n.getFullYear())}return""})(1e3*n().ts),[S,B]=m();E((()=>{B(k()),A=setInterval((()=>{B(k())}),6e4)}));const z=()=>n().a===ar.anchor.value&&n().am,O=()=>9802===n().k?"highlight":z()?"mention":"comment",_=x((()=>Zo(n())));return $((()=>clearInterval(A))),(()=>{const t=Di(),f=t.firstChild,y=f.firstChild,m=y.firstChild,E=m.firstChild,A=E.firstChild,k=E.nextSibling,B=k.firstChild,$=B.firstChild,z=$.nextSibling,T=z.firstChild,I=T.firstChild.nextSibling;I.nextSibling,T.nextSibling;const C=B.nextSibling,P=C.firstChild,L=m.nextSibling,R=y.nextSibling,N=R.nextSibling,U=N.nextSibling;return A.addEventListener("error",(()=>g(Ko))),Q($,(()=>{var e;return(null==(e=b())?void 0:e.n)||Vo(w())})),Q(T,O,I),Q(z,S,null),Q(k,(()=>{const e=x((()=>!!(_()>0&&h.width>600)));return()=>e()&&[qi(),(()=>{const e=Mi(),t=e.firstChild;return Q(e,_,t),Q(e,(()=>_()>1?"ies":"y"),null),Q(e,(()=>a()?" (hidden)":""),null),e})()]})(),C),P.$$click=()=>u(!l()),Q(P,us),Q(L,(()=>{const e=x((()=>_()>0));return()=>e()&&(()=>{const e=Vi(),t=e.firstChild;return t.$$click=()=>c(!a()),Q(t,(()=>{const e=x((()=>!!a()));return()=>e()?fs():ds()})()),e})()})()),Q(f,(()=>{const e=x((()=>!!l()));return()=>e()&&(()=>{const e=Fi(),t=e.firstChild;return v((()=>J(t,"href",ar.urlPrefixes.note+Mr(n().id)))),e})()})(),R),Q(R,(()=>{const e=x((()=>!(n().parent||!n().ro||ar.rootEventIds.includes(n().ro))));return()=>e()&&(()=>{const e=Wi(),t=e.firstChild,r=t.firstChild.nextSibling,o=r.nextSibling.nextSibling;return Q(e,hs,t),Q(t,O,r),v((()=>J(o,"href",ar.urlPrefixes.note+Mr(n().ro)))),e})()})(),null),Q(R,(()=>{const e=x((()=>!(n().parent||n().ro)));return()=>e()&&(()=>{const e=Ki(),t=e.firstChild,n=t.firstChild.nextSibling;return n.nextSibling,Q(e,hs,t),Q(t,O,n),e})()})(),null),Q(R,(()=>{const e=x((()=>!(n().parent||!n().ro||!ar.rootEventIds.includes(n().ro)||!ar.version||ar.version===n().ro)));return()=>e()&&(()=>{const e=Zi(),t=e.firstChild,n=t.firstChild.nextSibling;return n.nextSibling,Q(e,hs,t),Q(t,O,n),e})()})(),null),Y(d,N),Q(f,(()=>{const e=x((()=>!(!(h.height&&h.height>=500)||i())));return()=>e()&&(()=>{const e=Gi(),t=e.firstChild,n=t.nextSibling;return t.style.setProperty("height","20px"),Q(t,ls),n.$$click=()=>s(!0),e})()})(),U),Q(U,V(W,{get when(){return!ar.disableFeatures.includes("reply")},get children(){const e=Hi(),t=e.firstChild;return e.$$click=()=>o(!r())&&u(!1),Q(e,ss,t),Q(t,(()=>r()?"Cancel":"Reply")),e}})),Q(f,(()=>{const e=x((()=>!!r()));return()=>e()&&V(Ci,{get replyTo(){return n().id},onDone:()=>o(!1)})})(),null),Q(t,(()=>{const t=x((()=>!a()));return()=>t()&&(()=>{const t=Ji();return Q(t,V(is,{nestedEvents:()=>n().children,get articles(){return e.articles}})),t})()})(),null),v((t=>{const r=p(),o=ar.urlPrefixes.npub+w(),s=!(9802!=n().k),a=i()?{}:{"max-height":"500px"},c=qo(n(),ar,e.articles());return r!==t._v$&&J(A,"src",t._v$=r),o!==t._v$2&&J($,"href",t._v$2=o),s!==t._v$3&&N.classList.toggle("highlight",t._v$3=s),t._v$4=function(e,t,n){if(!t)return n?J(e,"style"):t;const r=e.style;if("string"==typeof t)return r.cssText=t;let o,i;for(i in"string"==typeof n&&(r.cssText=n=void 0),n||(n={}),t||(t={}),n)null==t[i]&&r.removeProperty(i),delete n[i];for(i in t)o=t[i],o!==n[i]&&(r.setProperty(i,o),n[i]=o);return n}(N,a,t._v$4),c!==t._v$5&&(N.innerHTML=t._v$5=c),t}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t})()}})),n})()},ss=()=>(()=>{const e=Yi();return J(e,"width",Wo),J(e,"height",Wo),e})(),as=()=>(()=>{const e=Qi();return J(e,"width",Wo),J(e,"height",Wo),e})(),cs=()=>(()=>{const e=Xi();return J(e,"width",Wo),J(e,"height",Wo),e})(),ls=()=>(()=>{const e=es();return J(e,"width",Wo),J(e,"height",Wo),e})(),us=()=>ts(),fs=()=>ns(),ds=()=>rs(),hs=()=>(()=>{const e=os();return J(e,"height",Wo),e})();G(["click"]);var ps={};!function(e){function t(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function n(...e){const t=(e,t)=>n=>e(t(n));return{encode:Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),decode:e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0)}}function r(e){return{encode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("alphabet.encode input should be an array of numbers");return n.map((n=>{if(t(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function o(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function i(e,n="="){if(t(e),"string"!=typeof n)throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("padding.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;t.length*e%8;)t.push(n);return t},decode(t){if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("padding.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=t.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&t[r-1]===n;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,r)}}}function s(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function a(e,n,r){if(n<2)throw new Error(`convertRadix: wrong from=${n}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let o=0;const i=[],s=Array.from(e);for(s.forEach((e=>{if(t(e),e<0||e>=n)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,t=!0;for(let i=o;i<s.length;i++){const a=s[i],c=n*e+a;if(!Number.isSafeInteger(c)||n*e/n!==e||c-a!=n*e)throw new Error("convertRadix: carry overflow");if(e=c%r,s[i]=Math.floor(c/r),!Number.isSafeInteger(s[i])||s[i]*r+e!==c)throw new Error("convertRadix: carry overflow");t&&(s[i]?t=!1:o=i)}if(i.push(e),t)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=t;const c=(e,t)=>t?c(t,e%t):e,l=(e,t)=>e+(t-c(e,t));function u(e,n,r,o){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(n<=0||n>32)throw new Error(`convertRadix2: wrong from=${n}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(l(n,r)>32)throw new Error(`convertRadix2: carry overflow from=${n} to=${r} carryBits=${l(n,r)}`);let i=0,s=0;const a=2**r-1,c=[];for(const l of e){if(t(l),l>=2**n)throw new Error(`convertRadix2: invalid data word=${l} from=${n}`);if(i=i<<n|l,s+n>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${n}`);for(s+=n;s>=r;s-=r)c.push((i>>s-r&a)>>>0);i&=2**s-1}if(i=i<<r-s&a,!o&&s>=n)throw new Error("Excess padding");if(!o&&i)throw new Error(`Non-zero padding: ${i}`);return o&&s>0&&c.push(i>>>0),c}function f(e){return t(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return a(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(a(t,e,256))}}}function d(e,n=!1){if(t(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(l(8,e)>32||l(e,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(t),8,e,!n)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(t,e,8,n))}}}function h(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(n){}}}function p(e,n){if(t(e),"function"!=typeof n)throw new Error("checksum fn should be function");return{encode(t){if(!(t instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=n(t).slice(0,e),o=new Uint8Array(t.length+e);return o.set(t),o.set(r,t.length),o},decode(t){if(!(t instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=t.slice(0,-e),o=n(r).slice(0,e),i=t.slice(-e);for(let n=0;n<e;n++)if(o[n]!==i[n])throw new Error("Invalid checksum");return r}}}e.utils={alphabet:r,chain:n,checksum:p,radix:f,radix2:d,join:o,padding:i},e.base16=n(d(4),r("0123456789ABCDEF"),o("")),e.base32=n(d(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),i(5),o("")),e.base32hex=n(d(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),i(5),o("")),e.base32crockford=n(d(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),s((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=n(d(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i(6),o("")),e.base64url=n(d(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),i(6),o(""));const g=e=>n(f(58),r(e),o(""));e.base58=g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let n="";for(let r=0;r<t.length;r+=8){const o=t.subarray(r,r+8);n+=e.base58.encode(o).padStart(y[o.length],"1")}return n},decode(t){let n=[];for(let r=0;r<t.length;r+=11){const o=t.slice(r,r+11),i=y.indexOf(o.length),s=e.base58.decode(o);for(let e=0;e<s.length-i;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(n)}};e.base58check=t=>n(p(4,(e=>t(t(e)))),e.base58);const w=n(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),m=[996825010,642813549,513874426,1027748829,705979059];function b(e){const t=e>>25;let n=(33554431&e)<<5;for(let r=0;r<m.length;r++)1==(t>>r&1)&&(n^=m[r]);return n}function v(e,t,n=1){const r=e.length;let o=1;for(let i=0;i<r;i++){const t=e.charCodeAt(i);if(t<33||t>126)throw new Error(`Invalid prefix (${e})`);o=b(o)^t>>5}o=b(o);for(let i=0;i<r;i++)o=b(o)^31&e.charCodeAt(i);for(let i of t)o=b(o)^i;for(let i=0;i<6;i++)o=b(o);return o^=n,w.encode(u([o%2**30],30,5,!1))}function E(e){const t="bech32"===e?1:734539939,n=d(5),r=n.decode,o=n.encode,i=h(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const o=(e=r).lastIndexOf("1");if(0===o||-1===o)throw new Error('Letter "1" must be present between prefix and data only');const i=e.slice(0,o),s=e.slice(o+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=w.decode(s).slice(0,-6),c=v(i,a,t);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const o=e.length+7+n.length;if(!1!==r&&o>r)throw new TypeError(`Length ${o} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${w.encode(n)}${v(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:h(s),fromWords:r,fromWordsUnsafe:i,toWords:o}}e.bech32=E("bech32"),e.bech32m=E("bech32m"),e.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},e.hex=n(d(4),r("0123456789abcdef"),o(""),s((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const x={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},A=`Invalid encoding type. Available types: ${Object.keys(x).join(", ")}`;e.bytesToString=(e,t)=>{if("string"!=typeof e||!x.hasOwnProperty(e))throw new TypeError(A);if(!(t instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return x[e].encode(t)},e.str=e.bytesToString;e.stringToBytes=(e,t)=>{if(!x.hasOwnProperty(e))throw new TypeError(A);if("string"!=typeof t)throw new TypeError("stringToBytes() expects string");return x[e].decode(t)},e.bytes=e.stringToBytes}(ps);const{bech32:gs,hex:ys,utf8:ws}=ps,ms={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},bs={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},vs={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},Es={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},xs=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],As={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},ks=BigInt("2100000000000000000"),Ss=BigInt(1e11),Bs={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},$s={};for(let qs=0,Ms=Object.keys(Bs);qs<Ms.length;qs++){const e=Ms[qs],t=Bs[Ms[qs]].toString();$s[t]=e}const zs={1:e=>ys.encode(gs.fromWordsUnsafe(e)),16:e=>ys.encode(gs.fromWordsUnsafe(e)),13:e=>ws.encode(gs.fromWordsUnsafe(e)),19:e=>ys.encode(gs.fromWordsUnsafe(e)),23:e=>ys.encode(gs.fromWordsUnsafe(e)),27:e=>ys.encode(gs.fromWordsUnsafe(e)),6:_s,24:_s,3:function(e){const t=[];let n,r,o,i,s,a=gs.fromWordsUnsafe(e);for(;a.length>0;)n=ys.encode(a.slice(0,33)),r=ys.encode(a.slice(33,41)),o=parseInt(ys.encode(a.slice(41,45)),16),i=parseInt(ys.encode(a.slice(45,49)),16),s=parseInt(ys.encode(a.slice(49,51)),16),a=a.slice(51),t.push({pubkey:n,short_channel_id:r,fee_base_msat:o,fee_proportional_millionths:i,cltv_expiry_delta:s});return t},5:function(e){const t=e.slice().reverse().map((e=>[!!(1&e),!!(2&e),!!(4&e),!!(8&e),!!(16&e)])).reduce(((e,t)=>e.concat(t)),[]);for(;t.length<2*xs.length;)t.push(!1);const n={};xs.forEach(((e,r)=>{let o;o=t[2*r]?"required":t[2*r+1]?"supported":"unsupported",n[e]=o}));const r=t.slice(2*xs.length);return n.extra_bits={start_bit:2*xs.length,bits:r,has_required:r.reduce(((e,t,n)=>n%2!=0?e||!1:e||t),!1)},n}};function Os(e){return t=>({tagCode:parseInt(e),words:gs.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function _s(e){return e.reverse().reduce(((e,t,n)=>e+t*Math.pow(32,n)),0)}function Ts(e,t){let n,r;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),r=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=e}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const o=BigInt(r),i=n?o*Ss/As[n]:o*Ss;if("p"===n&&o%BigInt(10)!==BigInt(0)||i>ks)throw new Error("Amount is outside of valid range");return t?i.toString():i}var Is={decode:function(e,t){if("string"!=typeof e)throw new Error("Lightning Payment Request must be string");if("ln"!==e.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],r=gs.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();const o=r.prefix;let i=r.words,s=e.slice(o.length+1),a=i.slice(-104);i=i.slice(0,-104);let c=o.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(c&&!c[2]&&(c=o.match(/^ln(\S+)$/)),!c)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const l=c[1];let u;if(t){if(void 0===t.bech32||void 0===t.pubKeyHash||void 0===t.scriptHash||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");u=t}else switch(l){case ms.bech32:u=ms;break;case bs.bech32:u=bs;break;case vs.bech32:u=vs;break;case Es.bech32:u=Es}if(!u||u.bech32!==l)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:l,value:u});const f=c[2];let d;if(f){d=Ts(f+c[3],!0),n.push({name:"amount",letters:c[2]+c[3],value:d})}else d=null;n.push({name:"separator",letters:"1"});const h=_s(i.slice(0,7));let p,g,y,w;for(i=i.slice(7),n.push({name:"timestamp",letters:s.slice(0,7),value:h}),s=s.slice(7);i.length>0;){const e=i[0].toString();p=$s[e]||"unknown_tag",g=zs[e]||Os(e),i=i.slice(1),y=_s(i.slice(0,2)),i=i.slice(2),w=i.slice(0,y),i=i.slice(y),n.push({name:p,tag:s[0],letters:s.slice(0,3+y),value:g(w)}),s=s.slice(3+y)}n.push({name:"signature",letters:s.slice(0,104),value:ys.encode(gs.fromWordsUnsafe(a))}),s=s.slice(104),n.push({name:"checksum",letters:s});let m={paymentRequest:e,sections:n,get expiry(){let e=n.find((e=>"expiry"===e.name));if(e)return b("timestamp")+e.value},get route_hints(){return n.filter((e=>"route_hint"===e.name)).map((e=>e.value))}};for(let v in Bs)"route_hint"!==v&&Object.defineProperty(m,v,{get:()=>b(v)});return m;function b(e){let t=n.find((t=>t.name===e));return t?t.value:void 0}},hrpToMillisat:Ts};const Cs=Z("<div id=ztr-root><style></style><div style=float:right;opacity:0.2;>"),Ps=Z("<div id=ztr-content>"),Ls=Z("<h1>Error!"),Rs=Z("<div class=ztr-comment-text><pre></pre><p>Only properly formed NIP-19 naddr, note and nevent encoded entities and URLs are supported."),Ns=Z("<h2 id=ztr-title>"),Us=Z("<p>Powered by <a href=https://github.com/fr4nzap/zapthreads>zapthreads"),js=Z("<button>Clear cache"),Hs=Z("<p>Anchor version: "),Ds=e=>{b((()=>{ar.anchor=(()=>{const t=e.anchor.trim();try{if(t.startsWith("http")){const n=!e.legacyUrl;return{type:"http",value:Jo(t,n)}}const n=Hr(t);switch(n.type){case"nevent":return{type:"note",value:n.data.id};case"note":return{type:"note",value:n.data};case"naddr":const e=n.data;return{type:"naddr",value:`${e.kind}:${e.pubkey}:${e.identifier}`}}}catch(n){return console.error(n),{type:"error",value:`Malformed anchor: ${t}`}}})();ar.relays=(e.relays||"wss://relay.damus.io,wss://nos.lol").split(",").map((e=>new URL(e).toString())),(e.author||"").startsWith("npub")&&(ar.externalAuthor=e.author),ar.disableFeatures=e.disable.split(",").map((e=>e.trim())).filter(ur),ar.urlPrefixes=((e="")=>{const t={naddr:"https://nostr.com/",npub:"https://nostr.com/",nprofile:"https://nostr.com/",nevent:"https://nostr.com/",note:"https://nostr.com/",tag:"https://snort.social/t/"};for(const n of e.split(",")){const[e,r]=n.split(":");r&&(t[e]=`https://${r}`)}return t})(e.urls),ar.replyPlaceholder=e.replyPlaceholder}));const t=()=>ar.anchor,n=()=>ar.relays,r=()=>e.version;ar.profiles=Bo((()=>["profiles"]));const o=()=>ar.disableFeatures.includes("watch");b(B([t],(()=>{ar.version=r()}))),b(B([t,n],(async()=>{if("error"===t().type)return;let r,o;switch(t().type){case"http":o=await zo("events",t().value,{index:"r"}),ar.rootEventIds=Fo(o).map((e=>e.id));r={"#r":e.legacyUrl?[t().value]:[t().value,`${t().value}/`],kinds:[1,8812]};break;case"note":const n=await Oo("events",IDBKeyRange.only(t().value));if(n)return o=[n],ar.rootEventIds=[n.id],void(ar.anchorAuthor=n.pk);o=[],r={ids:[t().value]};break;case"naddr":const[i,s,a]=t().value.split(":");o=(await zo("events",a,{index:"d"})).filter((e=>e.pk===s)),o.length>0&&(ar.rootEventIds=Fo(o).map((e=>e.id)),ar.anchorAuthor=o[0].pk),r={authors:[s],kinds:[parseInt(i)],"#d":[a]};break;default:throw"error"}const i=(await sr.querySync(n(),{...r})).map(Eo);for(const e of i)"http"==t().type?(1==e.k&&e.c.includes("↴")||8812==e.k)&&Io("events",e):Io("events",e);switch(t().type){case"http":case"naddr":const e=[...o,...i],t=Fo([...e]).map((e=>e.id));(t.length>0&&t[0])!==ar.rootEventIds[0]&&(ar.rootEventIds=t);break;case"note":ar.rootEventIds=i.map((e=>e.id))}i.length>0&&(ar.anchorAuthor=i[0].pk)})));const i=()=>ar.rootEventIds;b(B([i,r],(()=>{switch(t().type){case"http":case"note":return void((ar.filter["#e"]??[]).toString()!==i().toString()&&(ar.filter={"#e":i()}));case"naddr":const e=ar.filter["#a"]&&ar.filter["#a"][0];return t().value!==e&&(ar.filter={"#a":[t().value]}),void(ar.version=r()||i()[0])}}),{defer:!0}));const s=x((()=>ar.filter),{defer:!0});let a;E(B([s],(async()=>{const e=s(),r=n(),i=t(),c=d(),l=ar.profiles();if(0===Object.entries(e).length)return;null==a||a.close(),a=null,$((()=>{console.log("[zapthreads] unsubscribing and cleaning up",i.value),null==a||a.close(),a=null}));console.log("[zapthreads] subscribing to",i.value);const u=await(async(e,t)=>{const n=(await zo("relays",e.value,{index:"a"})).filter((e=>t.includes(e.n))).map((e=>e.l));return n.length>0?Math.min(...n)+1:0})(i,r),f=new Set,h={};a=sr.subscribeMany(r,[{...e,kinds:[1,9802,7,9735],since:u}],{onevent(e){if(1===e.kind||9802===e.kind)e.content.trim()&&Io("events",Eo(e));else if(7===e.kind)f.add(e.id);else if(9735===e.kind){const t=e.tags.find((e=>"bolt11"===e[0]));t&&t[1]&&(h[e.id]=t[1])}},oneose(){(async()=>{const e=await Oo("aggregates",IDBKeyRange.only([i.value,7]))??{eid:i.value,ids:[],k:7};e.ids=[...new Set([...e.ids,...f])],Io("aggregates",e);const t=await Oo("aggregates",IDBKeyRange.only([i.value,9735]))??{eid:i.value,ids:[],k:9735,sum:0};t.sum=Object.entries(h).reduce(((e,n)=>{if(t.ids.includes(n[0]))return e;const r=Is.decode(n[1]).sections.find((e=>"amount"===e.name));return e+Number(r.value)/1e3}),t.sum??0),t.ids=[...new Set([...t.ids,...Object.keys(h)])],Io("aggregates",t)})(),setTimeout((async()=>{await Ro([...c.map((e=>e.pk))],r,l),(async(e,t)=>{const n={};for(const o of t){const e=sr.seenOn.get(o.id);if(e)for(const t of e)o.ts>(n[t.url]||0)&&(n[t.url]=o.ts)}const r=await zo("relays",e.value,{index:"a"});for(const o in n){const t=r.find((e=>e.n===o));t?n[o]>t.l&&(t.l=n[o],Io("relays",t)):Io("relays",{n:o,a:e.value,l:n[o]})}})(i,c),o()&&(null==a||a.close(),sr.close(r))}),96)}})}),{defer:!0}));const c=()=>e.user;b(B(c,(e=>{if(e){let t,n;e.startsWith("nsec")?(n=Hr(e).data,t=ii(n)):t=Hr(e).data,cr.external={pk:t,signEvent:async e=>{if(n)return{sig:si(e,n).sig};if(!window.nostr)throw alert("Please log in with a NIP-07 extension such as Alby or nos2x"),cr.active=void 0,"No extension available";const r=await window.nostr.getPublicKey();if(t!==r){const e=`ERROR: Event not signed. Supplied pubkey does not match extension pubkey. ${t} !== ${r}`;throw cr.active=void 0,alert(e),e}return window.nostr.signEvent(e)}},cr.active=cr.external}}))),b(B(c,(e=>{e||(cr.active=void 0)}),{defer:!0}));const l=Bo((()=>["events",30023,{index:"k"}])),u=x((()=>{if(ar.disableFeatures.includes("hideContent")&&"naddr"===t().type){const[e,n,r]=t().value.split(":"),o=l().find((e=>e.d===r&&e.pk===n));if(o){const e=`# ${o.tl}\n ${o.c}`;return qo({...o,c:e},ar,[])}}})),f=x((()=>{switch(t().type){case"http":case"note":return Bo((()=>["events",ar.rootEventIds,{index:"ro"}]));case"naddr":return Bo((()=>["events",t().value,{index:"a"}]));default:return()=>[]}})),d=()=>f()(),h=x((()=>{if(ar.rootEventIds&&ar.rootEventIds.length){return Yo(d()).filter((e=>!(9802===e.k&&0===e.children.length)))}return[]})),p=()=>h().reduce(((e,t)=>e+Zo(t)),h().length),[g,y]=m(!1);return(()=>{const e=Cs(),n=e.firstChild,r=n.nextSibling;return Q(n,"#ztr-content,\n#ztr-content img {\n  max-width: 100%;\n}\n\n#ztr-root {\n  display: flex;\n  flex-direction: column;\n  font-family: var(--ztr-font);\n  font-size: var(--ztr-font-size);\n  color: var(--ztr-text-color);\n  border: 1px solid transparent;\n  word-wrap: break-word;\n  /* removes margin collapse */\n  margin-top: 4em;\n  line-height: 1.2em;\n}\n\n#ztr-subtitle {\n  font-size: 1.2em;\n  color: #666;\n}\n\na {\n  color: var(--ztr-link-color);\n  text-decoration: none;\n}\n\n/* Comment */\n\n.ztr-comment {\n  position: relative;\n  margin: 0;\n  padding: 0;\n}\n\n.ztr-comment,\n.ztr-reply-button {\n  background-color: var(--ztr-background-color, rgba(0, 0, 0, 0.03));\n}\n\n.ztr-comment-body {\n  padding: 1em;\n}\n\n.ztr-comment:first-child {\n  border-top-left-radius: 0.3em;\n  border-top-right-radius: 0.3em;\n}\n\n.ztr-comment:last-child {\n  border-bottom-left-radius: 0.3em;\n  border-bottom-right-radius: 0.3em;\n}\n\n.ztr-comment-info-wrapper {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.ztr-comment-info {\n  display: flex;\n  align-items: center;\n}\n\n.ztr-comment-info-picture {\n  width: 3.5em;\n}\n\nul.ztr-comment-info-items {\n  display: flex;\n  align-items: center;\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  font-size: 0.9em;\n}\n\nul.ztr-comment-info-items li {\n  display: inline-block;\n  cursor: default;\n  padding-right: 0.5em;\n}\n\nul.ztr-comment-info-items li a {\n  font-weight: 600;\n}\n\n.ztr-comment-info-author a {\n  font-size: 1.2em;\n  padding-right: 0.2em;\n}\n\n.ztr-comment-info-dots {\n  cursor: pointer;\n}\n\n.ztr-comment-info-separator {\n  width: 0.5em;\n}\n\n.ztr-comment-info-picture img {\n  width: 2em;\n  height: 2em;\n  border-radius: 50%;\n  padding: 0.5em;\n  position: relative;\n  display: block;\n  object-fit: cover;\n}\n\n.ztr-comment-text,\n#ztr-content {\n  margin-bottom: 0.75em;\n  padding: 0 0.8em 0 3.5em;\n  line-height: 1.5em;\n  line-break: loose;\n  word-break: break-word;\n  overflow: hidden;\n  max-width: 750px;\n}\n\n.ztr-comment-text p {\n  margin: 0 0 0.5em 0;\n}\n\n.ztr-comment-text code {\n  font-size: 1.1em;\n  margin: 0 0.2em;\n}\n\n.ztr-comment-text pre,\n.ztr-info-pane pre {\n  white-space: pre-wrap;\n  white-space: -moz-pre-wrap;\n  word-wrap: break-word;\n}\n\n.ztr-comment-text a:hover {\n  text-decoration: underline;\n}\n\n.ztr-comment-text img {\n  max-width: 100%;\n}\n\n.ztr-comment-text .warning {\n  margin-top: 0em;\n  font-size: 0.8em;\n  display: flex;\n  align-items: center;\n}\n\n.ztr-comment-text .warning svg {\n  height: 1.2em;\n  fill: #e4984d;\n  padding-right: 0.7em;\n}\n\n.ztr-comment-replies {\n  margin-left: 2em;\n}\n\n.highlight p {\n  background: #F6AD55;\n  color: #2B2B2B;\n  display: inline;\n  padding: 0.2em;\n}\n\n/* Styling the reply to comment form */\n\n.ztr-comment-expand {\n  display: flex;\n  justify-content: center;\n}\n\n.ztr-comment-expand span {\n  margin: 1em 0 1em 0.35em;\n  cursor: pointer;\n}\n\nul.ztr-comment-actions,\n.ztr-comment-expand {\n  display: flex;\n  align-items: center;\n  list-style: none;\n  margin: 0;\n  padding: 0 0 0 3.5em;\n  font-weight: 600;\n  user-select: none;\n}\n\nul.ztr-comment-actions li {\n  display: inline-flex;\n  align-items: center;\n  text-align: center;\n  padding: 0 2em 0 0;\n  cursor: pointer;\n}\n\nul.ztr-comment-actions li span {\n  padding: 0.25em 0.25em 0 0.25em;\n  color: var(--ztr-icon-color, #3B3B3B);\n}\n\nsvg {\n  fill: var(--ztr-icon-color, #3B3B3B);\n  width: 1.1em;\n  height: 1.1em;\n}\n\n.ztr-comment-action-reply:hover svg {\n  fill: #92379c;\n}\n\n.ztr-comment-action-reply:hover span {\n  color: #92379c;\n}\n\n.ztr-comment-action-zap:hover svg {\n  fill: #e4984d;\n}\n\n.ztr-comment-action-zap:hover span {\n  color: #e4984d;\n}\n\n.ztr-comment-action-like:hover svg {\n  fill: #e35428;\n}\n\n.ztr-comment-action-like:hover span {\n  color: #e35428;\n}\n\n.ztr-reply-form {\n  padding: 0 0.5em 0 3.5em;\n}\n\n.ztr-reply-form textarea {\n  font-family: var(--ztr-font);\n  font-size: 1.1em;\n  line-height: 1.4;\n  color: #2B2B2B;\n  background-color: #FDFDFD;\n  border: 1px solid #BBB;\n  outline: none;\n  width: calc(100% - 1.5em);\n  padding: 0.7em;\n  margin: 0.5em 0;\n  height: 4em;\n  border-radius: 0.2em;\n  min-height: 4em;\n  resize: vertical;\n}\n\n.ztr-reply-form:disabled {\n  opacity: 65%;\n  user-select: none;\n}\n\n.ztr-reply-controls {\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n}\n\n.ztr-reply-controls span {\n  font-weight: bold;\n  font-size: 0.85em;\n  margin-right: 1em;\n  user-select: none;\n  cursor: default;\n}\n\n.ztr-reply-error {\n  color: rgb(202, 23, 23);\n}\n\n.ztr-reply-controls button {\n  font-family: var(--ztr-font);\n  appearance: none;\n  border: none;\n  padding: 0.5em 1em;\n  border-radius: 0.2em;\n  font-size: 0.85em;\n  font-weight: 600;\n  cursor: pointer;\n}\n\n.ztr-reply-login-button {\n  color: white;\n  background-color: var(--ztr-login-button-color, #2B2B2B);\n  margin-left: 1em;\n}\n\n.ztr-reply-button {\n  color: var(--ztr-text-color);\n  display: flex;\n  align-items: center;\n}\n\n.ztr-info-pane {\n  padding: 0 0.5em 1em 3.5em;\n}\n\n.ztr-info-pane pre {\n  font-size: 0.8em;\n}\n\n.ztr-spinner {\n  width: 1.2em;\n  height: 1.2em;\n  padding: 0.9em;\n  animation: rotate 4s linear infinite;\n}\n\n.ztr-reply-button:disabled {\n  opacity: 65%;\n  pointer-events: none;\n  cursor: pointer;\n  user-select: none;\n}\n\n.ztr-spinner .path {\n  stroke: var(--ztr-text-color, #2B2B2B);\n  stroke-linecap: round;\n  animation: dash 1.5s ease-in-out infinite;\n}\n\n@keyframes rotate {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes dash {\n  0% {\n    stroke-dasharray: 1, 150;\n    stroke-dashoffset: 0;\n  }\n\n  50% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -35;\n  }\n\n  100% {\n    stroke-dasharray: 90, 150;\n    stroke-dashoffset: -124;\n  }\n}\n\n/* new */\n\n.ztr-comment-new .ztr-reply-form {\n  margin: 0.5em 0;\n  padding: 0;\n}\n\n.ztr-comment-new .ztr-comment-body {\n  padding: 0;\n}\n\n.ztr-comment-new .ztr-comment-actions {\n  font-size: 1.1em;\n  padding: 0;\n}\n\n/* Dark mode defaults */\n\n@media (prefers-color-scheme: dark) {\n  .ztr-spinner .path {\n    stroke: var(--ztr-text-color, #DEDEDE);\n  }\n\n  .ztr-comment,\n  .ztr-reply-button {\n    background-color: var(--ztr-background-color, rgba(255, 255, 255, 0.06));\n  }\n\n  .ztr-reply-login-button {\n    color: #2B2B2B;\n    background-color: var(--ztr-login-button-color, #DEDEDE);\n  }\n\n  svg {\n    fill: var(--ztr-icon-color, #DEDEDE);\n  }\n\n  ul.ztr-comment-actions li span {\n    color: var(--ztr-icon-color);\n  }\n\n  .ztr-comment-action-reply:hover svg {\n    fill: #96609c;\n  }\n\n  .ztr-comment-action-reply:hover span {\n    color: #96609c;\n  }\n}"),Q(e,(()=>{const e=x((()=>!!u()));return()=>e()&&(()=>{const e=Ps();return v((()=>e.innerHTML=u())),e})()})(),r),Q(e,(()=>{const e=x((()=>"error"===t().type));return()=>e()&&[Ls(),(()=>{const e=Rs();return Q(e.firstChild,(()=>t().value)),e})()]})(),r),Q(e,(()=>{const e=x((()=>"error"!==t().type));return()=>e()&&[x((()=>{const e=x((()=>!ar.disableFeatures.includes("reply")));return()=>e()&&V(Pi,{})})()),(()=>{const e=Ns();return Q(e,(()=>{const e=x((()=>p()>0));return()=>e()&&`${p()} comment${1==p()?"":"s"}`})()),e})(),V(is,{nestedEvents:h,articles:l})]})(),r),r.$$click=()=>y(!g()),Q(r,us),Q(e,(()=>{const e=x((()=>!!g()));return()=>e()&&[Us(),x((()=>{const e=x((()=>!!ar.version));return()=>e()&&(()=>{const e=Hs();return e.firstChild,Q(e,(()=>ar.version),null),e})()})()),(()=>{const e=js();return function(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const r=n[0];e.addEventListener(t,n[0]=t=>r.call(e,n[1],t))}else e.addEventListener(t,n)}(e,"click",Co,!0),e})()]})(),null),e})()};return function(e,t,n){2===arguments.length&&(n=t,t={}),ue(e,t)(fe(n))}("zap-threads",{anchor:"",version:"",relays:"",user:"",author:"",disable:"",urls:"","reply-placeholder":"","legacy-url":""},(e=>V(Ds,{get anchor(){return e.anchor??""},get version(){return e.version??""},get relays(){return e.relays??""},get user(){return e.user??""},get author(){return e.author??""},get disable(){return e.disable??""},get urls(){return e.urls??""},get replyPlaceholder(){return e["reply-placeholder"]??""},get legacyUrl(){return e["legacy-url"]??""}}))),G(["click"]),Ds}();
